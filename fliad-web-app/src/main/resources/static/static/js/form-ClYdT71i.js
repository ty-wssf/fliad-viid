import{r as e}from"./formRules-B2bzcXv4.js";import{h as a,t}from"./index-DcffTgQN.js";import{b as l}from"./ant-design-vendor-CRFwT3Wn.js";import{d as r,f as i,o,a1 as b,a6 as u,V as s,a2 as n,k as m,u as d,U as c,Z as v,F as p,G as q}from"./vue-vendor-BzDj5Url.js";const f=(e,...t)=>a("/viid/datasource/"+e,...t),g={viidDatasourcePage:e=>f("page",e,"get"),viidDatasourceSubmitForm:(e,a=!1)=>f(a?"edit":"add",e),viidDatasourceDelete:e=>f("delete",e),viidDatasourceDetail:e=>f("detail",e,"get"),disableDatasource:e=>f("disableDatasource",e),enableDatasource:e=>f("enableDatasource",e),viidDatasourceCopy:e=>f("copy",e)},_=r({name:"viidDatasourceForm"}),y=Object.assign(_,{emits:{successful:null},setup(a,{expose:r,emit:f}){const _=i(!1),y=f,h=i(),P=i({config:{}}),w=i(!1),R=i([]),x=i([]);o(()=>{R.value=[{label:"RabbitMQ",value:"rabbitmq"}]});const U=()=>{h.value.resetFields(),P.value={rabbitmqHost:void 0,rabbitmqPort:void 0,rabbitmqUsername:void 0,rabbitmqPassword:void 0,rabbitmqExchange:void 0,rabbitmqRoutingKey:void 0,rabbitmqQueueName:void 0},_.value=!1},D={title:[e("请输入标题")],subscribeDetail:[e("请选择订阅类别")],type:[e("请选择类型")],rabbitmqHost:[e("请输入RabbitMQ地址"),{validator:(e,a)=>{if(!a)return Promise.reject("");if(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(a)){const e=a.split(".");for(let a of e){const e=parseInt(a,10);if(e<0||e>255)return Promise.reject("请输入有效的IP地址或域名")}return Promise.resolve()}return/^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,6}$/.test(a)&&(a.includes(".")||/^[a-zA-Z0-9]+$/.test(a))?Promise.resolve():Promise.reject("请输入有效的IP地址或域名")},trigger:"blur"}],rabbitmqPort:[e("请输入RabbitMQ端口")],rabbitmqUsername:[e("请输入用户名")],rabbitmqPassword:[e("请输入密码")],rabbitmqExchange:[e("请输入Exchange")],rabbitmqRoutingKey:[e("请输入Routing Key")],rabbitmqQueueName:[e("请输入队列名")]},Q=()=>{h.value.validate().then(()=>{w.value=!0;const e=l(P.value);"rabbitmq"===e.type&&(e.content=JSON.stringify({host:e.rabbitmqHost,port:e.rabbitmqPort,username:e.rabbitmqUsername,password:e.rabbitmqPassword,exchange:e.rabbitmqExchange,routingKey:e.rabbitmqRoutingKey,queueName:e.rabbitmqQueueName}),delete e.rabbitmqHost,delete e.rabbitmqPort,delete e.rabbitmqUsername,delete e.rabbitmqPassword,delete e.rabbitmqExchange,delete e.rabbitmqRoutingKey,delete e.rabbitmqQueueName),g.viidDatasourceSubmitForm(e,e.id).then(()=>{U(),y("successful")}).finally(()=>{w.value=!1})})};return r({onOpen:e=>{if(_.value=!0,e){let t=l(e);if(t.content&&"string"==typeof t.content)try{const e=JSON.parse(t.content);t.rabbitmqHost=e.host,t.rabbitmqPort=e.port,t.rabbitmqUsername=e.username,t.rabbitmqPassword=e.password,t.rabbitmqExchange=e.exchange,t.rabbitmqRoutingKey=e.routingKey,t.rabbitmqQueueName=e.queueName}catch(a){}P.value=Object.assign({},t)}else P.value={rabbitmqHost:void 0,rabbitmqPort:void 0,rabbitmqUsername:void 0,rabbitmqPassword:void 0,rabbitmqExchange:void 0,rabbitmqRoutingKey:void 0,rabbitmqQueueName:void 0};x.value=t.dictList("VIID_Subscribe_Detail_Type")}}),(e,a)=>{const t=b("a-input"),l=b("a-form-item"),r=b("a-col"),i=b("a-select"),o=b("a-row"),f=b("a-input-number"),g=b("a-input-password"),y=b("a-textarea"),K=b("a-form"),N=b("a-button"),j=b("a-drawer");return s(),u(j,{title:d(P).id?"编辑数据源":"增加数据源",width:600,visible:d(_),"destroy-on-close":!0,"footer-style":{textAlign:"right"},onClose:U},{footer:n(()=>[m(N,{style:{"margin-right":"8px"},onClick:U},{default:n(()=>a[11]||(a[11]=[q("关闭")])),_:1}),m(N,{type:"primary",onClick:Q,loading:d(w)},{default:n(()=>a[12]||(a[12]=[q("保存")])),_:1},8,["loading"])]),default:n(()=>[m(K,{ref_key:"formRef",ref:h,model:d(P),rules:D,layout:"vertical"},{default:n(()=>[m(o,{gutter:24},{default:n(()=>[m(r,{span:24},{default:n(()=>[m(l,{label:"标题：",name:"title"},{default:n(()=>[m(t,{value:d(P).title,"onUpdate:value":a[0]||(a[0]=e=>d(P).title=e),placeholder:"请输入标题","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),m(r,{span:12},{default:n(()=>[m(l,{label:"订阅类别：",name:"subscribeDetail"},{default:n(()=>[m(i,{value:d(P).subscribeDetail,"onUpdate:value":a[1]||(a[1]=e=>d(P).subscribeDetail=e),placeholder:"请选择订阅类别",options:d(x)},null,8,["value","options"])]),_:1})]),_:1}),m(r,{span:12},{default:n(()=>[m(l,{label:"类型：",name:"type"},{default:n(()=>[m(i,{value:d(P).type,"onUpdate:value":a[2]||(a[2]=e=>d(P).type=e),placeholder:"请选择类型",options:d(R)},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),"rabbitmq"===d(P).type?(s(),c(p,{key:0},[m(o,{gutter:24},{default:n(()=>[m(r,{span:12},{default:n(()=>[m(l,{label:"RabbitMQ地址：",name:"rabbitmqHost"},{default:n(()=>[m(t,{value:d(P).rabbitmqHost,"onUpdate:value":a[3]||(a[3]=e=>d(P).rabbitmqHost=e),placeholder:"请输入RabbitMQ地址","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),m(r,{span:12},{default:n(()=>[m(l,{label:"RabbitMQ端口：",name:"rabbitmqPort"},{default:n(()=>[m(f,{value:d(P).rabbitmqPort,"onUpdate:value":a[4]||(a[4]=e=>d(P).rabbitmqPort=e),placeholder:"请输入RabbitMQ端口",style:{width:"100%"},min:1,max:65535,precision:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),m(o,{gutter:24},{default:n(()=>[m(r,{span:12},{default:n(()=>[m(l,{label:"用户名：",name:"rabbitmqUsername"},{default:n(()=>[m(t,{value:d(P).rabbitmqUsername,"onUpdate:value":a[5]||(a[5]=e=>d(P).rabbitmqUsername=e),placeholder:"请输入用户名","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),m(r,{span:12},{default:n(()=>[m(l,{label:"密码：",name:"rabbitmqPassword"},{default:n(()=>[m(g,{value:d(P).rabbitmqPassword,"onUpdate:value":a[6]||(a[6]=e=>d(P).rabbitmqPassword=e),placeholder:"请输入密码"},null,8,["value"])]),_:1})]),_:1})]),_:1}),m(o,{gutter:24},{default:n(()=>[m(r,{span:12},{default:n(()=>[m(l,{label:"交换机：",name:"rabbitmqExchange"},{default:n(()=>[m(t,{value:d(P).rabbitmqExchange,"onUpdate:value":a[7]||(a[7]=e=>d(P).rabbitmqExchange=e),placeholder:"请输入Exchange","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),m(r,{span:12},{default:n(()=>[m(l,{label:"路由键：",name:"rabbitmqRoutingKey"},{default:n(()=>[m(t,{value:d(P).rabbitmqRoutingKey,"onUpdate:value":a[8]||(a[8]=e=>d(P).rabbitmqRoutingKey=e),placeholder:"请输入Routing Key","allow-clear":""},null,8,["value"])]),_:1})]),_:1})]),_:1}),m(o,{gutter:24},{default:n(()=>[m(r,{span:24},{default:n(()=>[m(l,{label:"队列名：",name:"rabbitmqQueueName"},{default:n(()=>[m(t,{value:d(P).rabbitmqQueueName,"onUpdate:value":a[9]||(a[9]=e=>d(P).rabbitmqQueueName=e),placeholder:"请输入队列名","allow-clear":""},null,8,["value"])]),_:1})]),_:1})]),_:1})],64)):v("",!0),m(o,{gutter:24},{default:n(()=>[m(r,{span:24},{default:n(()=>[m(l,{label:"备注：",name:"remark"},{default:n(()=>[m(y,{value:d(P).remark,"onUpdate:value":a[10]||(a[10]=e=>d(P).remark=e),placeholder:"请输入备注","auto-size":{minRows:3,maxRows:6},"allow-clear":""},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"])}}}),h=Object.freeze(Object.defineProperty({__proto__:null,default:y},Symbol.toStringTag,{value:"Module"}));export{y as _,h as f,g as v};
