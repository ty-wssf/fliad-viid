import{_ as e,c as a}from"./index-DcffTgQN.js";import{w as l,y as t,b as n,k as s}from"./ant-design-vendor-CRFwT3Wn.js";import{d as u,f as o,w as r,a1 as d,U as i,V as c,a6 as v,Z as p,k as f,a2 as h,X as y,F as g,W as m,u as k,Y as _,ag as x,a3 as w,H as C,G as b}from"./vue-vendor-BzDj5Url.js";const I=["onMouseover","onMouseleave"],z={class:"user-delete"},A={class:"user-name"},L={class:"table-operator xn-mb10"},M={class:"user-table"},T={key:0,class:"xn-fdr"},B={class:"mt-2"},S={class:"user-table"},E={key:0,class:"xn-fdr"},F=u({name:"userSelector"}),U=e(Object.assign(F,{props:{radioModel:{type:Boolean,default:()=>!1},dataIsConverterFlw:{type:Boolean,default:()=>!1},orgTreeApi:{type:Function},userPageApi:{type:Function},userListByIdListApi:{type:Function},value:{default:()=>""},dataType:{type:String,default:()=>"string"},userShow:{type:Boolean,default:()=>!0},addShow:{type:Boolean,default:()=>!0}},emits:["update:value","onBack"],setup(e,{expose:u,emit:F}){const U=o(!1),O=o(""),K=[{title:"操作",dataIndex:"action",align:"center",width:50},{title:"头像",dataIndex:"avatar",width:50},{title:"用户名",dataIndex:"name",ellipsis:!0},{title:"账号",dataIndex:"account"}],P=[{title:"操作",dataIndex:"action",align:"center",width:50},{title:"用户名",dataIndex:"name",ellipsis:!0}],R=e,j=o(),G=o(),D=o(),Y=o({}),$=o(),H=o(!0),J=o(!1),V=o(!1),W={children:"children",title:"name",key:"id"},X=o(),Z=o([]),q=F,N=o([]),Q=o([]),ee=o([]),ae=o(0),le=o(20),te=o(0),ne=e=>"function"==typeof R.userListByIdListApi?R.userListByIdListApi(e):a.userCenterGetUserListByIdList(e).then(e=>Promise.resolve(e)),se=()=>{if("function"!=typeof R.orgTreeApi)return void s.warning("未配置选择器需要的orgTreeApi接口");if("function"!=typeof R.userPageApi)return void s.warning("未配置选择器需要的userPageApi接口");if(U.value=!0,R.orgTreeApi().then(e=>{null!==e&&(X.value=e,X.value.forEach(e=>{"0"===e.parentId&&(Z.value.push(e.id),e.children&&e.children.forEach(e=>{Z.value.push(e.id)}))}))}).finally(()=>{H.value=!1}),Y.value.size=le.value,ue(),l(ee.value))return;const e={idList:ee.value};V.value=!0,ne(e).then(e=>{Q.value=e}).finally(()=>{V.value=!1})},ue=()=>{J.value=!0,R.userPageApi(Y.value).then(e=>{ae.value=e.current,te.value=e.total,N.value=[],D.value=0,N.value=e.records,e.records?D.value=e.records.length:D.value=0}).finally(()=>{J.value=!1})},oe=(e,a)=>{Y.value.current=e,Y.value.size=a,ue()},re=e=>{if(R.radioModel&&Q.value.length>0)return void s.warning("只可选择一条");0===Q.value.filter(a=>a.id===e.id).length?Q.value.push(e):s.warning("该记录已存在")},de=()=>{let e=Q.value.concat(N.value),a=[];for(let l of e){let e=!0;for(let t of a)l.id===t.id&&(e=!1);e&&a.push(l)}Q.value=a},ie=()=>{Q.value=[]},ce=e=>{Y.value.current=0,e.length>0?Y.value.orgId=e.toString():delete Y.value.orgId,ue()},ve=o([]),pe=()=>{ve.value=[];const e=[],a=[];Q.value.forEach(l=>{const t={id:l.id,name:l.name};e.push(l.id);const s=n(t);s.avatar=l.avatar,a.push(s)}),ve.value=a;const l=ye(e);q("update:value",l),q("onBack",l),fe()},fe=()=>{Y.value={},D.value=0,N.value=[],ae.value=0,le.value=20,te.value=0,Q.value=[],U.value=!1},he=e=>{if(R.dataIsConverterFlw){const a=[];if(l(e.value)){if(!l(e)&&!l(e[0])&&!l(e[0].value)){const l=e[0].value.split(",");for(let e=0;e<l.length;e++)a.push(l[e])}}else{const l=e.value.split(",");l.length>0?l.forEach(e=>{a.push(e)}):a.push(e.value)}return a}if("string"!==ge())return e;if(e.length>1){const a=[];return e.split(",").forEach(e=>{a.push(e)}),a}return e},ye=e=>{if(R.dataIsConverterFlw){e=ve.value;const a={};let l="",t="";for(let n=0;n<e.length;n++)e.length===n+1?(l+=e[n].name,t+=e[n].id):(l=l+e[n].name+",",t=t+e[n].id+",");return a.key="USER",a.label=l,a.value=t,a.extJson="",a}{if("string"!==ge())return e;let a="";return e.forEach(e=>{a=a+","+e}),a=a.substring(1,a.length),a}},ge=()=>R.dataType?R.dataType:R.radioModel?"string":typeof typeof R.value,me=e=>{if(l(ve.value)&&!l(e)){const e={idList:ee.value};ne(e).then(e=>{ve.value=e})}};return r(()=>R.value,e=>{if(l(R.value))ve.value=[],Q.value=[];else{const a=he(e);ee.value=a,me(a)}},{immediate:!0}),u({showUserPlusModal:(e=[])=>{const a=he(e);ee.value=a,me(a),se()}}),(a,s)=>{const u=d("CloseCircleFilled"),o=d("a-avatar"),r=d("PlusOutlined"),F=d("a-button"),ne=d("a-flex"),he=d("a-tree"),ge=d("a-card"),me=d("a-col"),ke=d("a-input"),_e=d("a-form-item"),xe=d("a-row"),we=d("a-form"),Ce=d("a-table"),be=d("a-pagination"),Ie=d("MinusOutlined"),ze=d("a-modal");return c(),i(g,null,[R.userShow?(c(),v(ne,{key:0,wrap:"wrap",gap:"small"},{default:h(()=>[(c(!0),i(g,null,m(k(ve),(e,a)=>(c(),i("div",{class:"user-container",key:e.id,onMouseover:e=>(e=>{O.value=e})(a),onMouseleave:e=>{O.value=""}},[_("span",z,[f(u,{class:x([a===k(O)?"show-delete-icon":"","delete-icon"]),onClick:a=>(e=>{t(ve.value,a=>a.id===e.id),t(ee.value,a=>a===e.id);const a=[],l=[];ve.value.forEach(e=>{const t={id:e.id,name:e.name};a.push(e.id);const s=n(t);s.avatar=e.avatar,l.push(s)}),ve.value=l;const s=ye(a);q("update:value",s),q("onBack",s)})(e)},null,8,["class","onClick"]),f(o,{src:e.avatar},null,8,["src"])]),_("span",A,w(e.name),1)],40,I))),128)),R.radioModel&&1===k(ve).length||!e.addShow?p("",!0):(c(),v(F,{key:0,shape:"circle",onClick:se},{default:h(()=>[f(r)]),_:1})),y(a.$slots,"button",{},void 0,!0)]),_:3})):p("",!0),f(ze,{open:k(U),"onUpdate:open":s[6]||(s[6]=e=>C(U)?U.value=e:null),title:"用户选择",width:1e3,"mask-closable":!1,"destroy-on-close":!0,onOk:pe,onCancel:fe},{default:h(()=>[f(xe,{gutter:10},{default:h(()=>[f(me,{span:7},{default:h(()=>[f(ge,{size:"small",loading:k(H),class:"selectorTreeDiv"},{default:h(()=>[k(X)?(c(),v(he,{key:0,expandedKeys:k(Z),"onUpdate:expandedKeys":s[0]||(s[0]=e=>C(Z)?Z.value=e:null),"tree-data":k(X),"field-names":W,onSelect:ce},null,8,["expandedKeys","tree-data"])):p("",!0)]),_:1},8,["loading"])]),_:1}),f(me,{span:11},{default:h(()=>[_("div",L,[f(we,{ref_key:"searchFormRef",ref:$,name:"advanced_search",class:"ant-advanced-search-form",model:k(Y)},{default:h(()=>[f(xe,{gutter:24},{default:h(()=>[f(me,{span:12},{default:h(()=>[f(_e,{name:"searchKey"},{default:h(()=>[f(ke,{value:k(Y).searchKey,"onUpdate:value":s[1]||(s[1]=e=>k(Y).searchKey=e),placeholder:"请输入用户名"},null,8,["value"])]),_:1})]),_:1}),f(me,{span:12},{default:h(()=>[f(F,{type:"primary",class:"xn-mr-10",onClick:s[2]||(s[2]=e=>ue())},{default:h(()=>s[7]||(s[7]=[b(" 查询 ")])),_:1}),f(F,{onClick:s[3]||(s[3]=e=>(delete Y.value.searchKey,void ue()))},{default:h(()=>s[8]||(s[8]=[b(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",M,[f(Ce,{ref_key:"tableRef",ref:j,size:"small",columns:K,"data-source":k(N),"expand-row-by-click":!0,loading:k(J),bordered:"",pagination:!1},{title:h(()=>[_("span",null,"待选择列表 "+w(k(D))+" 条",1),e.radioModel?p("",!0):(c(),i("div",T,[f(F,{type:"dashed",size:"small",onClick:de},{default:h(()=>s[9]||(s[9]=[b("添加当前数据")])),_:1})]))]),bodyCell:h(({column:e,record:l})=>["avatar"===e.dataIndex?(c(),v(o,{key:0,src:l.avatar,style:{"margin-bottom":"-5px","margin-top":"-5px"}},null,8,["src"])):p("",!0),"action"===e.dataIndex?(c(),v(F,{key:1,type:"dashed",size:"small",onClick:e=>re(l)},{default:h(()=>[f(r)]),_:2},1032,["onClick"])):p("",!0),"category"===e.dataIndex?(c(),i(g,{key:2},[b(w(a.$TOOL.dictTypeData("ROLE_CATEGORY",l.category)),1)],64)):p("",!0)]),_:1},8,["data-source","loading"]),_("div",B,[k(l)(k(N))?p("",!0):(c(),v(be,{key:0,current:k(ae),"onUpdate:current":s[4]||(s[4]=e=>C(ae)?ae.value=e:null),"page-size":k(le),"onUpdate:pageSize":s[5]||(s[5]=e=>C(le)?le.value=e:null),total:k(te),size:"small",showSizeChanger:"",onChange:oe},null,8,["current","page-size","total"]))])])]),_:1}),f(me,{span:6},{default:h(()=>[_("div",S,[f(Ce,{ref_key:"selectedTable",ref:G,size:"small",columns:P,"data-source":k(Q),"expand-row-by-click":!0,loading:k(V),bordered:""},{title:h(()=>[_("span",null,"已选择: "+w(k(Q).length),1),e.radioModel?p("",!0):(c(),i("div",E,[f(F,{type:"dashed",danger:"",size:"small",onClick:ie},{default:h(()=>s[10]||(s[10]=[b("全部移除")])),_:1})]))]),bodyCell:h(({column:e,record:a})=>["action"===e.dataIndex?(c(),v(F,{key:0,type:"dashed",danger:"",size:"small",onClick:e=>(e=>{t(Q.value,a=>a.id===e.id)})(a)},{default:h(()=>[f(Ie)]),_:2},1032,["onClick"])):p("",!0)]),_:1},8,["data-source","loading"])])]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),[["__scopeId","data-v-a74d1ba0"]]);export{U as _};
