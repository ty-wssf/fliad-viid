import{j as e,t as a,D as l}from"./index-DcffTgQN.js";import{b as t,k as o,U as u}from"./ant-design-vendor-CRFwT3Wn.js";import{d,f as s,w as p,a1 as i,U as r,V as n,a6 as c,Z as f,k as v,X as m,a2 as h,G as y,a3 as g,u as U,H as R,Y as L,F as w}from"./vue-vendor-BzDj5Url.js";const x={key:0,class:"clearfix"},C={style:{"margin-top":"8px"}},b={key:0,class:"clearfix"},I={style:{"margin-top":"8px"}},T=["src"],S={key:1,width:"100%",controls:"",type:"video",id:"video"},_=["src"],k=["data"],q=["src"],A={class:"ant-upload-drag-icon"},E={class:"ant-upload-text"},N=d({name:"uploadIndex"}),M=Object.assign(N,{props:{uploadReturnIdApi:{type:String,default:e("/dev/file/uploadLocalReturnId"),required:!1},uploadDynamicReturnUrlApi:{type:String,default:e("/dev/file/uploadDynamicReturnUrl"),required:!1},uploadIdDownloadUrl:{type:String,default:e("/dev/file/download?id="),required:!1},uploadMode:{type:String,default:"file",required:!1},uploadNumber:{type:Number,default:1,required:!1},uploadText:{type:String,default:"上传",required:!1},uploadResultType:{type:String,default:"url",required:!1},uploadResultCategory:{type:String,default:"interval",required:!1},showUploadList:{type:Boolean,default:!0,required:!1},accept:{type:String,default:"",required:!1},completeResult:{type:Boolean,default:!1,required:!1},value:{type:[String,Array],default:void 0,required:!1}},emits:["update:value","onChange","onSuccessful"],setup(e,{expose:d,emit:N}){const M=s([]),D=N,P=s(!1),j=s(""),O=s(""),F=s({token:a.data.get("TOKEN")}),G=s(""),W=e,z="id"===W.uploadResultType?l.API_URL+W.uploadReturnIdApi:l.API_URL+W.uploadDynamicReturnUrlApi,B=(e,a)=>({data:e||l.API_URL+W.uploadIdDownloadUrl+a,name:e||a,url:e||l.API_URL+W.uploadIdDownloadUrl+a,status:"done",response:{data:e||a,code:200}});p(()=>W.value,e=>{W.value&&e&&(M.value=[],(e=>{if("interval"===W.uploadResultCategory&&("id"===W.uploadResultType&&e.split(",").forEach(e=>{const a=B(void 0,e);M.value.push(a),M.value.reverse()}),"url"===W.uploadResultType&&e.split(",").forEach(e=>{const a=B(e);M.value.push(a),M.value.reverse()})),"array"===W.uploadResultCategory)if(W.completeResult){let a=t(e);a.map(e=>{e.thumbUrl&&delete e.thumbUrl,"id"===W.uploadResultType&&(e.url=l.API_URL+W.uploadIdDownloadUrl+e.response.data),"url"===W.uploadResultType&&(e.url=e.response.data)}),M.value=a}else"id"===W.uploadResultType&&e.forEach(e=>{M.value.push(B(void 0,e))}),"url"===W.uploadResultType&&e.forEach(e=>{M.value.push(B(e))})})(e))},{immediate:!0,deep:!0}),p(()=>W.uploadMode,e=>{e&&"image"===e?W.accept?G.value=W.accept:G.value="image/*":G.value=W.accept},{immediate:!0,deep:!0});const H={strokeWidth:5,format:e=>parseFloat(e.toFixed(2))+"%"},K=e=>{if("image"==W.uploadMode){const a=e.type.startsWith("image/");return a||o.warning("只能上传图片类型文件"),a||u.LIST_IGNORE}if("video"==W.uploadMode){const a=e.type.startsWith("video/");return a||o.warning("只能上传视频类型文件"),a||u.LIST_IGNORE}},V=async e=>{P.value=!0,j.value=e.name,"id"===W.uploadResultType?O.value=l.API_URL+W.uploadIdDownloadUrl+e.response.data:O.value=e.response.data},X=()=>{P.value=!1,j.value="",O.value=""},Y=e=>{let a=[];const l=e.file;if(l&&("done"===l.status||"removed"===l.status)&&l.response&&200===l.response.code&&e.fileList.forEach(e=>{a.push(e)}),a.length>0){if("interval"===W.uploadResultCategory){const e=s("");a.forEach(a=>{e.value=a.response.data+(e.value?","+e.value:"")}),D("update:value",e),D("onSuccessful",e),D("onChange",e)}else if("array"===W.uploadResultCategory)if(W.completeResult){let e=t(a);e.map(e=>{e.thumbUrl&&delete e.thumbUrl}),D("update:value",e),D("onSuccessful",e),D("onChange",e)}else{const e=s([]);a.forEach(a=>{e.value.push(a.response.data)}),D("update:value",e),D("onSuccessful",e),D("onChange",e)}}else D("update:value",void 0),D("onChange",void 0)};return d({uploadFileList:()=>{if(M.value){const e=[];return M.value.forEach(a=>{const l={name:a.name,type:a.type,size:a.size,url:a.response.data};e.push(l)}),e}return[]}}),(e,a)=>{const l=i("upload-outlined"),t=i("a-button"),o=i("a-upload"),u=i("plus-outlined"),d=i("a-modal"),s=i("inbox-outlined"),p=i("a-upload-dragger");return n(),r("div",null,["file"===W.uploadMode?(n(),c(o,{key:0,"file-list":U(M),"onUpdate:fileList":a[0]||(a[0]=e=>R(M)?M.value=e:null),name:"file",action:U(z),headers:U(F),maxCount:W.uploadNumber,progress:H,onChange:Y,showUploadList:W.showUploadList,accept:U(G)},{default:h(()=>[v(t,null,{default:h(()=>[v(l),y(" "+g(W.uploadText),1)]),_:1})]),_:1},8,["file-list","action","headers","maxCount","showUploadList","accept"])):f("",!0),"video"===W.uploadMode?(n(),c(o,{key:1,"file-list":U(M),"onUpdate:fileList":a[1]||(a[1]=e=>R(M)?M.value=e:null),name:"file",action:U(z),headers:U(F),maxCount:W.uploadNumber,"before-upload":K,"list-type":"picture-card",onChange:Y,onPreview:V,progress:H,showUploadList:W.showUploadList,accept:U(G)},{default:h(()=>[U(M).length<W.uploadNumber?(n(),r("div",x,[v(u),L("div",C,g(W.uploadText),1)])):f("",!0)]),_:1},8,["file-list","action","headers","maxCount","showUploadList","accept"])):f("",!0),"image"===W.uploadMode?(n(),c(o,{key:2,"file-list":U(M),"onUpdate:fileList":a[2]||(a[2]=e=>R(M)?M.value=e:null),name:"file",action:U(z),headers:U(F),maxCount:W.uploadNumber,"before-upload":K,"list-type":"picture-card",onChange:Y,onPreview:V,progress:H,showUploadList:W.showUploadList,accept:U(G)},{default:h(()=>[U(M).length<W.uploadNumber?(n(),r("div",b,[v(u),L("div",I,g(W.uploadText),1)])):f("",!0)]),_:1},8,["file-list","action","headers","maxCount","showUploadList","accept"])):f("",!0),v(d,{open:U(P),title:U(j),footer:null,destroyOnClose:!0,onCancel:X},{default:h(()=>["image"===W.uploadMode?(n(),r("img",{key:0,alt:"example",style:{width:"100%"},src:U(O)},null,8,T)):"video"===W.uploadMode?(n(),r("video",S,[L("source",{src:U(O),type:"video/mp4"},null,8,_),L("object",{data:U(O),width:"100%"},[L("embed",{src:U(O),width:"100%"},null,8,q)],8,k),a[4]||(a[4]=y(" 您的浏览器不支持video标签哦，请联系管理员 "))])):(n(),r(w,{key:2},[y(" 暂不支持该文件预览 ")],64))]),_:1},8,["open","title"]),"drag"===W.uploadMode?(n(),c(p,{key:3,fileList:U(M),"onUpdate:fileList":a[3]||(a[3]=e=>R(M)?M.value=e:null),name:"file",multiple:!0,action:U(z),headers:U(F),maxCount:W.uploadNumber,onChange:Y,progress:H,showUploadList:W.showUploadList,accept:U(G)},{default:h(()=>[L("p",A,[v(s)]),L("p",E,g(W.uploadText),1),a[5]||(a[5]=L("p",{class:"ant-upload-hint"},null,-1))]),_:1},8,["fileList","action","headers","maxCount","showUploadList","accept"])):f("",!0),m(e.$slots,"explain")])}}});export{M as _};
