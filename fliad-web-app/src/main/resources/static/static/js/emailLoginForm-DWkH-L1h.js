import{r as e,a}from"./formRules-B2bzcXv4.js";import{c as l}from"./clientLoginApi-CbOluBR5.js";import{a as t}from"./util-CNugiXN7.js";import{k as i}from"./ant-design-vendor-CRFwT3Wn.js";import{d,f as o,a1 as n,U as s,V as u,k as m,a2 as r,u as v,G as c,a3 as f,Y as p,H as C,F as _}from"./vue-vendor-BzDj5Url.js";import"./index-DcffTgQN.js";const g=["src"],x=d({name:"emailLoginForm"}),h=Object.assign(x,{setup(d){const x=o(),h=o({}),k=o(!1);let y=o({time:60,smsSendBtn:!1}),w=o({});const b=o(""),B=()=>{w.value.email=[e("请输入正确的邮箱号"),a.email],delete w.value.emailValidCode,x.value.validate().then(()=>{j.value=!0,U()})},V=async()=>{w.value.email=[e("请输入正确的邮箱号"),a.email],w.value.emailValidCode=[e("请输入邮箱验证码"),a.number];if(!(await x.value.validate().catch(()=>{})))return!1;h.value.validCode=h.value.emailValidCode,h.value.validCodeReqNo=b.value,k.value=!0,l.clientLoginByEmail(h.value).then(e=>{t(e)}).finally(()=>{k.value=!1})},j=o(!1),R=o(),S=o({}),z=o("");o("");const L={validCode:[e("请输入图形验证码"),a.lettersNum]},U=()=>{l.clientGetPicCaptcha().then(e=>{z.value=e.validCodeBase64,S.value.validCodeReqNo=e.validCodeReqNo})},F=()=>{j.value=!1},N=()=>{R.value.validate().then(()=>{j.value=!1,S.value.email=h.value.email,y.value.smsSendBtn=!0;const e=window.setInterval(()=>{y.value.time--<=0&&(y.value.time=60,y.value.smsSendBtn=!1,window.clearInterval(e))},1e3),a=i.loading("验证码发送中..",0);l.clientGetEmailValidCode(S.value).then(e=>{b.value=e,j.value=!1,setTimeout(a,500),S.value.validCode=""}).catch(()=>{setTimeout(a,100),clearInterval(e),y.value.smsSendBtn=!1})})};return(e,a)=>{const l=n("mail-outlined"),t=n("a-input"),i=n("a-form-item"),d=n("a-col"),o=n("a-button"),b=n("a-row"),q=n("a-form"),G=n("verified-outlined"),I=n("a-modal");return u(),s(_,null,[m(q,{ref_key:"emailLoginFormRef",ref:x,model:v(h),rules:v(w)},{default:r(()=>[m(i,{name:"email"},{default:r(()=>[m(t,{value:v(h).email,"onUpdate:value":a[0]||(a[0]=e=>v(h).email=e),placeholder:"请输入邮箱号",size:"large"},{prefix:r(()=>[m(l,{class:"text-black text-opacity-25"})]),_:1},8,["value"])]),_:1}),m(i,{name:"emailValidCode"},{default:r(()=>[m(b,{gutter:8},{default:r(()=>[m(d,{span:16},{default:r(()=>[m(t,{value:v(h).emailValidCode,"onUpdate:value":a[1]||(a[1]=e=>v(h).emailValidCode=e),placeholder:"请输入验证码",size:"large"},{prefix:r(()=>[m(l,{class:"text-black text-opacity-25"})]),_:1},8,["value"])]),_:1}),m(d,{span:8},{default:r(()=>[m(o,{size:"large",class:"xn-wd",onClick:B,disabled:v(y).smsSendBtn},{default:r(()=>[c(f(v(y).smsSendBtn?v(y).time+" s":"获取验证码"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),m(i,null,{default:r(()=>[m(o,{type:"primary",class:"xn-wd",loading:v(k),round:"",size:"large",onClick:V},{default:r(()=>a[4]||(a[4]=[c(" 登录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),m(I,{open:v(j),"onUpdate:open":a[3]||(a[3]=e=>C(j)?j.value=e:null),width:400,title:"机器验证",onCancel:F,onOk:N},{default:r(()=>[m(q,{ref_key:"emailLoginFormModalRef",ref:R,model:v(S),rules:L},{default:r(()=>[m(i,{name:"validCode"},{default:r(()=>[m(b,{gutter:8},{default:r(()=>[m(d,{span:17},{default:r(()=>[m(t,{value:v(S).validCode,"onUpdate:value":a[2]||(a[2]=e=>v(S).validCode=e),placeholder:"请输入验证码",size:"large"},{prefix:r(()=>[m(G,{class:"text-black text-opacity-25"})]),_:1},8,["value"])]),_:1}),m(d,{span:7},{default:r(()=>[p("img",{src:v(z),class:"xn-findform-line",onClick:U},null,8,g)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])],64)}}});export{h as default};
