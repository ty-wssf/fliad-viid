import{_ as e}from"./index-yCCQKvno.js";import{_ as a}from"./index-r8v7tfQO.js";import{_ as t,i as r,t as l}from"./index-DcffTgQN.js";import{d as s}from"./downloadUtil-80YX7TDG.js";import{F as o,b as n}from"./form-kqekzgRX.js";import{b as d}from"./bizOrgApi-8pcz4RXq.js";import{w as i,x as u,k as c}from"./ant-design-vendor-CRFwT3Wn.js";import{d as p,f as m,a1 as h,U as f,V as v,k as y,a2 as g,u as b,a6 as k,H as x,F as _,W as U,G as w,a3 as S,Z as I,Y as P}from"./vue-vendor-BzDj5Url.js";import"./index-yhO5Pkur.js";import"./index-BkEc3Qph.js";import"./formRules-B2bzcXv4.js";const R={key:1},E=["onClick"],z={class:"ant-dropdown-link"},C=["onClick"],$=["onClick"],O=p({name:"bizUser"}),D=t(Object.assign(O,{setup(t){const p=[{title:"头像",dataIndex:"avatar",align:"center",width:"80px"},{title:"账号",dataIndex:"account",ellipsis:!0},{title:"姓名",dataIndex:"name"},{title:"性别",dataIndex:"gender",width:"50px"},{title:"手机",dataIndex:"phone",ellipsis:!0},{title:"机构",dataIndex:"orgName",ellipsis:!0},{title:"职位",dataIndex:"positionName",ellipsis:!0},{title:"状态",dataIndex:"userStatus",width:"80px"}];r(["bizUserEdit","bizUserGrantRole","bizUserPwdReset","bizUserExportUserInfo","bizUserDelete"])&&p.push({title:"操作",dataIndex:"action",align:"center",width:"220px"});const O={refresh:!0,height:!0,columnSetting:!0},D=l.dictList("COMMON_STATUS"),j=m(),B=m([]),K=m({}),T=m(null),A=m([]),N=m([]),L={children:"children",title:"name",key:"id"},G=m(null),M=m(),F=m({}),H=m(!1),V=m(!0),W=e=>n.userPage(Object.assign(e,K.value)).then(e=>e),Y=()=>{j.value.resetFields(),T.value.refresh(!0)};d.orgTree().then(e=>{V.value=!1,null!==e&&(A.value=e,i(B.value)&&A.value.forEach(e=>{"0"===e.parentId&&(B.value.push(e.id),e.children&&e.children.forEach(e=>{B.value.push(e.id)}))}))}).finally(()=>{V.value=!1});const Z={alert:{show:!1,clear:()=>{N.value=m([])}},rowSelection:{onChange:(e,a)=>{N.value=e}}},q=e=>{e.length>0?K.value.orgId=e.toString():delete K.value.orgId,T.value.refresh(!0)},J=()=>{if(N.value.length<1&!K.value.searchKey&!K.value.userStatus&&c.warning("请输入查询条件或勾选要导出的信息"),N.value.length>0){const e={userIds:N.value.map(e=>e).join()};return void Q(e)}if(K.value.searchKey||K.value.userStatus){const e={searchKey:K.value.searchKey,userStatus:K.value.userStatus};Q(e)}},Q=e=>{n.userExport(e).then(e=>{s.resultDownload(e),T.value.clearSelected()})},X=e=>{n.userDelete(e).then(()=>{T.value.clearRefreshSelected()})},ee=e=>{let a={id:F.value.id,roleIdList:[]};e.length>0&&e.forEach(e=>{a.roleIdList.push(e)}),n.grantRole(a).then(()=>{})},ae={orgTreeApi:e=>n.userOrgTreeSelector(e).then(e=>Promise.resolve(e)),rolePageApi:e=>n.userRoleSelector(e).then(e=>Promise.resolve(e))};return(t,r)=>{const l=h("a-tree"),d=h("a-empty"),i=h("a-card"),c=h("a-col"),m=h("a-input"),Q=h("a-form-item"),te=h("a-select-option"),re=h("a-select"),le=h("SearchOutlined"),se=h("a-button"),oe=h("redo-outlined"),ne=h("a-row"),de=h("a-form"),ie=h("plus-outlined"),ue=h("export-outlined"),ce=a,pe=h("a-space"),me=h("a-avatar"),he=h("a-switch"),fe=h("a-divider"),ve=h("a-popconfirm"),ye=h("DownOutlined"),ge=h("a-menu-item"),be=h("a-menu"),ke=h("a-dropdown"),xe=h("s-table"),_e=e;return v(),f(_,null,[y(ne,{gutter:10},{default:g(()=>[y(c,{xs:24,sm:24,md:24,lg:5,xl:5},{default:g(()=>[y(i,{bordered:!1,loading:b(V),class:"left-tree-container"},{default:g(()=>[b(A).length>0?(v(),k(l,{key:0,expandedKeys:b(B),"onUpdate:expandedKeys":r[0]||(r[0]=e=>x(B)?B.value=e:null),"tree-data":b(A),"field-names":L,onSelect:q},null,8,["expandedKeys","tree-data"])):(v(),k(d,{key:1,image:b(u).PRESENTED_IMAGE_SIMPLE},null,8,["image"]))]),_:1},8,["loading"])]),_:1}),y(c,{xs:24,sm:24,md:24,lg:19,xl:19},{default:g(()=>[y(i,{bordered:!1,class:"xn-mb10"},{default:g(()=>[y(de,{ref_key:"searchFormRef",ref:j,name:"advanced_search",class:"ant-advanced-search-form",model:b(K)},{default:g(()=>[y(ne,{gutter:24},{default:g(()=>[y(c,{span:8},{default:g(()=>[y(Q,{name:"searchKey",label:t.$t("common.searchKey")},{default:g(()=>[y(m,{value:b(K).searchKey,"onUpdate:value":r[1]||(r[1]=e=>b(K).searchKey=e),placeholder:t.$t("user.placeholderNameAndSearchKey")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),y(c,{span:8},{default:g(()=>[y(Q,{name:"userStatus",label:t.$t("user.userStatus")},{default:g(()=>[y(re,{value:b(K).userStatus,"onUpdate:value":r[2]||(r[2]=e=>b(K).userStatus=e),placeholder:t.$t("user.placeholderUserStatus"),getPopupContainer:e=>e.parentNode},{default:g(()=>[(v(!0),f(_,null,U(b(D),e=>(v(),k(te,{key:e.value,value:e.value},{default:g(()=>[w(S(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","getPopupContainer"])]),_:1},8,["label"])]),_:1}),y(c,{span:8},{default:g(()=>[y(se,{type:"primary",onClick:r[3]||(r[3]=e=>b(T).refresh(!0))},{icon:g(()=>[y(le)]),default:g(()=>[w(" "+S(t.$t("common.searchButton")),1)]),_:1}),y(se,{class:"snowy-button-left",onClick:Y},{icon:g(()=>[y(oe)]),default:g(()=>[w(" "+S(t.$t("common.resetButton")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),y(i,{bordered:!1},{default:g(()=>[y(xe,{ref_key:"tableRef",ref:T,columns:p,data:W,"expand-row-by-click":!0,bordered:"",alert:Z.alert.show,"tool-config":O,"row-key":e=>e.id,"row-selection":Z.rowSelection},{operator:g(()=>[y(pe,null,{default:g(()=>[t.hasPerm("bizUserAdd")?(v(),k(se,{key:0,type:"primary",onClick:r[4]||(r[4]=e=>b(G).onOpen(void 0,b(K).orgId))},{icon:g(()=>[y(ie)]),default:g(()=>[P("span",null,S(t.$t("common.addButton"))+S(t.$t("model.user")),1)]),_:1})):I("",!0),t.hasPerm("bizUserBatchExport")?(v(),k(se,{key:1,onClick:J},{icon:g(()=>[y(ue)]),default:g(()=>[w(" "+S(t.$t("user.batchExportButton")),1)]),_:1})):I("",!0),t.hasPerm("bizUserBatchDelete")?(v(),k(ce,{key:2,buttonName:t.$t("common.batchRemoveButton"),icon:"DeleteOutlined",buttonDanger:"",selectedRowKeys:b(N),onBatchCallBack:X},null,8,["buttonName","selectedRowKeys"])):I("",!0)]),_:1})]),bodyCell:g(({column:e,record:a})=>["avatar"===e.dataIndex?(v(),k(me,{key:0,src:a.avatar,style:{"margin-bottom":"-5px","margin-top":"-5px"}},null,8,["src"])):I("",!0),"gender"===e.dataIndex?(v(),f(_,{key:1},[w(S(t.$TOOL.dictTypeData("GENDER",a.gender)),1)],64)):I("",!0),"userStatus"===e.dataIndex?(v(),f(_,{key:2},[t.hasPerm("bizUserUpdataStatus")?(v(),k(he,{key:0,loading:b(H),checked:"ENABLE"===a.userStatus,onChange:e=>(e=>{H.value=!0,"ENABLE"===e.userStatus?n.userDisableUser(e).then(()=>{T.value.refresh()}).finally(()=>{H.value=!1}):n.userEnableUser(e).then(()=>{T.value.refresh()}).finally(()=>{H.value=!1})})(a)},null,8,["loading","checked","onChange"])):(v(),f("span",R,S(t.$TOOL.dictTypeData("COMMON_STATUS",a.userStatus)),1))],64)):I("",!0),"action"===e.dataIndex?(v(),f(_,{key:3},[t.hasPerm("bizUserEdit")?(v(),f("a",{key:0,onClick:e=>b(G).onOpen(a)},S(t.$t("common.editButton")),9,E)):I("",!0),t.hasPerm(["bizUserEdit","bizUserDelete"],"and")?(v(),k(fe,{key:1,type:"vertical"})):I("",!0),y(ve,{title:t.$t("user.popconfirmDeleteUser"),onConfirm:e=>(e=>{let a=[{id:e.id}];n.userDelete(a).then(()=>{T.value.refresh()})})(a)},{default:g(()=>[t.hasPerm("bizUserDelete")?(v(),k(se,{key:0,type:"link",danger:"",size:"small"},{default:g(()=>[w(S(t.$t("common.removeButton")),1)]),_:1})):I("",!0)]),_:2},1032,["title","onConfirm"]),t.hasPerm(["bizUserGrantRole","bizUserPwdReset","bizUserExportUserInfo"])?(v(),k(fe,{key:2,type:"vertical"})):I("",!0),t.hasPerm(["bizUserGrantRole","bizUserPwdReset","bizUserExportUserInfo"])?(v(),k(ke,{key:3},{overlay:g(()=>[y(be,null,{default:g(()=>[t.hasPerm("bizUserPwdReset")?(v(),k(ge,{key:0},{default:g(()=>[y(ve,{title:t.$t("user.popconfirmResatUserPwd"),placement:"topRight",onConfirm:e=>(e=>{n.userResetPassword(e).then(()=>{})})(a)},{default:g(()=>[P("a",null,S(t.$t("user.resetPassword")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):I("",!0),t.hasPerm("bizUserGrantRole")?(v(),k(ge,{key:1},{default:g(()=>[P("a",{onClick:e=>(e=>{F.value=e;const a={id:e.id};n.userOwnRole(a).then(e=>{M.value.showModel(e)})})(a)},S(t.$t("user.grantRole")),9,C)]),_:2},1024)):I("",!0),t.hasPerm("bizUserExportUserInfo")?(v(),k(ge,{key:2},{default:g(()=>[P("a",{onClick:e=>(e=>{const a={id:e.id};n.userExportUserInfo(a).then(e=>{s.resultDownload(e)})})(a)},S(t.$t("user.exportUserInfo")),9,$)]),_:2},1024)):I("",!0)]),_:2},1024)]),default:g(()=>[P("a",z,[w(S(t.$t("common.more"))+" ",1),y(ye)])]),_:2},1024)):I("",!0)],64)):I("",!0)]),_:1},8,["alert","row-key","row-selection"])]),_:1})]),_:1})]),_:1}),y(o,{ref_key:"formRef",ref:G,onSuccessful:r[5]||(r[5]=e=>b(T).refresh())},null,512),y(_e,{ref_key:"RoleSelectorPlusRef",ref:M,"org-tree-api":ae.orgTreeApi,"role-page-api":ae.rolePageApi,"add-show":!1,"role-global":!0,onOnBack:ee},null,8,["org-tree-api","role-page-api"])],64)}}}),[["__scopeId","data-v-5f422de1"]]);export{D as default};
