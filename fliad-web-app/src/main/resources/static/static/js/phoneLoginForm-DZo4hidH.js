import{r as e,a}from"./formRules-B2bzcXv4.js";import{l}from"./index-DcffTgQN.js";import{a as o}from"./login-Cg0fTS5R.js";import{k as t}from"./ant-design-vendor-CRFwT3Wn.js";import{d as n,g as d,f as i,a1 as s,U as u,V as r,k as p,a2 as v,u as m,G as c,a3 as h,Y as f,H as g,F as C}from"./vue-vendor-BzDj5Url.js";import"./smCrypto-fJLAcgxS.js";import"./configApi-BMiyCPj3.js";import"./keepAlive-BXK4dPiU.js";const _=["src"],x=n({name:"smsLoginForm"}),b=Object.assign(x,{setup(n){const{proxy:x}=d(),b=i(),k=i({}),y=i(!1);let $=i({time:60,smsSendBtn:!1}),w=i({});const j=i(""),V=()=>{w.value.phone=[e(x.$t("login.phoneInputNumberPlaceholder")),a.phone],delete w.value.phoneValidCode,b.value.validate().then(()=>{P.value=!0,z()})},B=async()=>{w.value.phone=[e(x.$t("login.phoneInputNumberPlaceholder")),a.phone],w.value.phoneValidCode=[e(x.$t("login.smsCodePlaceholder")),a.number];if(!(await b.value.validate().catch(()=>{})))return!1;k.value.validCode=k.value.phoneValidCode,k.value.validCodeReqNo=j.value,y.value=!0,l.loginByPhone(k.value).then(e=>{o(e)}).catch(e=>{y.value=!1})},P=i(!1),S=i(),I=i({}),N=i("");i("");const R={validCode:[e(x.$t("login.validError")),a.lettersNum]},z=()=>{l.getPicCaptcha().then(e=>{N.value=e.validCodeBase64,I.value.validCodeReqNo=e.validCodeReqNo})},U=()=>{P.value=!1},F=()=>{S.value.validate().then(()=>{P.value=!1,I.value.phone=k.value.phone,$.value.smsSendBtn=!0;const e=window.setInterval(()=>{$.value.time--<=0&&($.value.time=60,$.value.smsSendBtn=!1,window.clearInterval(e))},1e3),a=t.loading("验证码发送中..",0);l.getPhoneValidCode(I.value).then(e=>{j.value=e,P.value=!1,setTimeout(a,500),I.value.validCode=""}).catch(()=>{setTimeout(a,100),clearInterval(e),$.value.smsSendBtn=!1})})};return(e,a)=>{const l=s("mobile-outlined"),o=s("a-input-number"),t=s("a-form-item"),n=s("mail-outlined"),d=s("a-input"),i=s("a-col"),x=s("a-button"),j=s("a-row"),L=s("a-form"),q=s("verified-outlined"),A=s("a-modal");return r(),u(C,null,[p(L,{ref_key:"phoneLoginFormRef",ref:b,model:m(k),rules:m(w)},{default:v(()=>[p(t,{name:"phone"},{default:v(()=>[p(o,{value:m(k).phone,"onUpdate:value":a[0]||(a[0]=e=>m(k).phone=e),placeholder:e.$t("login.phonePlaceholder"),size:"large",style:{width:"100%"}},{prefix:v(()=>[p(l,{class:"text-black text-opacity-25"})]),_:1},8,["value","placeholder"])]),_:1}),p(t,{name:"phoneValidCode"},{default:v(()=>[p(j,{gutter:8},{default:v(()=>[p(i,{span:16},{default:v(()=>[p(d,{value:m(k).phoneValidCode,"onUpdate:value":a[1]||(a[1]=e=>m(k).phoneValidCode=e),placeholder:e.$t("login.smsCodePlaceholder"),size:"large"},{prefix:v(()=>[p(n,{class:"text-black text-opacity-25"})]),_:1},8,["value","placeholder"])]),_:1}),p(i,{span:8},{default:v(()=>[p(x,{size:"large",class:"xn-wd",onClick:V,disabled:m($).smsSendBtn},{default:v(()=>[c(h(!m($).smsSendBtn&&e.$t("login.getSmsCode")||m($).time+" s"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),p(t,null,{default:v(()=>[p(x,{type:"primary",class:"xn-wd",loading:m(y),round:"",size:"large",onClick:B},{default:v(()=>[c(h(e.$t("login.signIn")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),p(A,{open:m(P),"onUpdate:open":a[3]||(a[3]=e=>g(P)?P.value=e:null),width:400,title:e.$t("login.machineValidation"),onCancel:U,onOk:F},{default:v(()=>[p(L,{ref_key:"phoneLoginFormModalRef",ref:S,model:m(I),rules:R},{default:v(()=>[p(t,{name:"validCode"},{default:v(()=>[p(j,{gutter:8},{default:v(()=>[p(i,{span:17},{default:v(()=>[p(d,{value:m(I).validCode,"onUpdate:value":a[2]||(a[2]=e=>m(I).validCode=e),placeholder:e.$t("login.validLaceholder"),size:"large"},{prefix:v(()=>[p(q,{class:"text-black text-opacity-25"})]),_:1},8,["value","placeholder"])]),_:1}),p(i,{span:7},{default:v(()=>[f("img",{src:m(N),class:"xn-findform-line",onClick:z},null,8,_)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])],64)}}});export{b as default};
