import{_ as e}from"./index-yhO5Pkur.js";import{r as a}from"./roleApi-AgyZA8--.js";import{_ as t}from"./index-DcffTgQN.js";import{d as n,f as o,a1 as l,a6 as u,V as c,a2 as d,k as r,u as i,H as s,U as h,F as m,W as p,G as v,a7 as f,a3 as k,Z as b}from"./vue-vendor-BzDj5Url.js";import"./ant-design-vendor-CRFwT3Wn.js";const g={key:0},I=n({name:"grantMobileResourceForm"}),y=t(Object.assign(I,{emits:{successful:null},setup(t,{expose:n,emit:I}){const y=o(!1),C=o({}),_=I,x=o(!1),N=[{key:"parentName",title:"一级目录",dataIndex:"parentName",customCell:(e,a)=>{const t=e.parentName,n=C.value[t];return a===n[0]?{rowSpan:n.length}:{rowSpan:0}},width:150},{key:"title",title:"菜单",dataIndex:"title",width:240},{key:"button",title:"按钮授权",dataIndex:"button"}],E=o([]),w=o(""),U=o([]),M=async()=>{if(E.value.length>0)U.value=E.value.find(e=>e.id===w.value).menu;else{y.value=!0;const e=await a.roleMobileMenuTreeSelector();if(e&&e.length>0){const t={id:G.id},n=await a.roleOwnMobileMenu(t);y.value=!1,E.value=O(e,n),w.value=e[0].id,U.value=E.value[0].menu}else y.value=!1,U.value=[]}},j=["button"],L=o(!1);let G={id:"",grantInfoList:[]};const O=(e,a)=>(e.forEach(e=>{e.menu&&(e.menu.forEach(e=>{const t=o(0);a.grantInfoList.length>0&&a.grantInfoList.forEach(a=>{e.id===a.menuId&&(t.value++,a.buttonInfo&&a.buttonInfo.forEach(a=>{e.button.forEach(e=>{a===e.id&&(e.check=!0)})}))}),t.value>0&&(e.parentCheck=!0,e.nameCheck=!0)}),e.menu.sort((e,a)=>{let t=a.parentName.localeCompare(e.parentName);return 0!==t?t:Number(e.parentId)-Number(a.parentId)}),e.menu.forEach((e,a)=>{C.value[e.parentName]?C.value[e.parentName].push(a):C.value[e.parentName]=[a]}))}),e),S=(e,a)=>{let t=a.target.checked;!t&&(e=>j.every(a=>e[a].every(e=>!e.check)))(e)||t&&(e.nameCheck=t,e.parentCheck=t)},F=(e,a)=>{e.nameCheck=a,j.forEach(t=>{((e,a,t)=>{e[a].forEach(e=>{e.check=t})})(e,t,a)})},z=()=>{E.value=[],w.value="",U.value=[],C.value={},L.value=!1},A=()=>{const e=(G.grantInfoList=[],E.value.forEach(e=>{e.menu&&e.menu.forEach(e=>{const a={menuId:"",buttonInfo:[]};e.nameCheck&&(a.menuId=e.id,e.button.forEach(e=>{e.check&&a.buttonInfo.push(e.id)}),G.grantInfoList.push(a))})}),G);x.value=!0,a.roleGrantMobileMenu(e).then(()=>{z(),_("successful")}).finally(()=>{x.value=!1})};return n({onOpen:e=>{G.id=e.id,L.value=!0,C.value={},M()}}),(a,t)=>{const n=l("a-radio-button"),o=l("a-radio-group"),I=l("a-checkbox"),_=l("a-table"),j=l("a-spin"),G=l("a-button"),O=e;return c(),u(O,{title:"授权移动端资源",width:1e3,visible:i(L),"destroy-on-close":!0,"show-pagination":!1,onClose:z},{footer:d(()=>[r(G,{class:"xn-mr8",onClick:z},{default:d(()=>t[1]||(t[1]=[v("关闭")])),_:1}),r(G,{type:"primary",loading:i(x),onClick:A},{default:d(()=>t[2]||(t[2]=[v("保存")])),_:1},8,["loading"])]),default:d(()=>[r(j,{spinning:i(y)},{default:d(()=>[r(o,{value:i(w),"onUpdate:value":t[0]||(t[0]=e=>s(w)?w.value=e:null),"button-style":"solid",class:"xn-pb10"},{default:d(()=>[(c(!0),h(m,null,p(i(E),e=>(c(),u(n,{key:e.id,value:e.id,onClick:a=>{return t=e.id,w.value=t,void M();var t}},{default:d(()=>[(c(),u(f(e.icon))),v(" "+k(e.title),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"]),r(_,{size:"middle",columns:N,"data-source":i(U),pagination:!1,bordered:""},{bodyCell:d(({column:e,record:a})=>["parentName"===e.dataIndex?(c(),u(I,{key:0,checked:a.parentCheck,"onUpdate:checked":e=>((e,a)=>{e.parentCheck=a;const t=E.value.find(a=>e.module===a.id),n=e.parentName;C.value[n].forEach(e=>{const n=t.menu[e];F(n,a)})})(a,e)},{default:d(()=>[v(k(a.parentName),1)]),_:2},1032,["checked","onUpdate:checked"])):b("",!0),"title"===e.dataIndex?(c(),u(I,{key:1,checked:a.nameCheck,"onUpdate:checked":e=>F(a,e)},{default:d(()=>[v(k(a.title),1)]),_:2},1032,["checked","onUpdate:checked"])):b("",!0),"button"===e.dataIndex?(c(),h(m,{key:2},[a.button.length>0?(c(!0),h(m,{key:0},p(a.button,(e,t)=>(c(),h(m,{key:e.id},[r(I,{checked:e.check,"onUpdate:checked":a=>e.check=a,onChange:e=>S(a,e)},{default:d(()=>[v(k(e.title),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]),(t+1)%5==0?(c(),h("br",g)):b("",!0)],64))),128)):b("",!0)],64)):b("",!0)]),_:1},8,["data-source"])]),_:1},8,["spinning"])]),_:1},8,["visible"])}}}),[["__scopeId","data-v-68dad4ab"]]);export{y as default};
