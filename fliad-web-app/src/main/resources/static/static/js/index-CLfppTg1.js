import{_ as e}from"./index-r8v7tfQO.js";import{_ as a,v as l}from"./form-B4fULwhk.js";import{i as r}from"./index-DcffTgQN.js";import{k as t}from"./ant-design-vendor-CRFwT3Wn.js";import{d as i,r as s,f as n,a1 as u,U as o,V as c,k as d,a2 as b,u as m,G as f,Z as S,F as v,W as p,a6 as D,a3 as g,Y as k}from"./vue-vendor-BzDj5Url.js";import"./formRules-B2bzcXv4.js";import"./viidCascadePlatformApi-zqOJAWEq.js";import"./data-BOS9iFY_.js";const y=["onClick"],_={class:"ant-dropdown-link"},h=["onClick"],C=["onClick"],I=["onClick"],w=["onClick"],O=i({name:"subscribe"}),x=Object.assign(O,{setup(i){let O=s({});const x=n(),R=n(),P=n(),T=n(),j={refresh:!0,height:!0,columnSetting:!0,striped:!1},U=[{title:"订阅编号",dataIndex:"SubscribeID"},{title:"订阅标题",dataIndex:"Title"},{title:"订阅类别",dataIndex:"SubscribeDetail"},{title:"开始时间",dataIndex:"BeginTime"},{title:"结束时间",dataIndex:"EndTime"},{title:"订阅目标节点",dataIndex:"SubscriberRecoverOrgname"},{title:"订阅状态",dataIndex:"SubscribeStatus"}];r(["viidSubscribeDownEdit","viidSubscribeDownDelete"])&&U.push({title:"操作",dataIndex:"action",align:"center",width:"220px"});let L=n([]);const F={alert:{show:!1,clear:()=>{L=n([])}},rowSelection:{onChange:(e,a)=>{L.value=e}}},B=e=>{const a=JSON.parse(JSON.stringify(O));return l.viidSubscribePage(Object.assign(e,a)).then(e=>e)},E=()=>{if(L.value.length<1)return t.warning("请选择一条或多条数据"),!1;const e=L.value.map(e=>({SubscribeID:e}));l.viidSubscribeDelete(e).then(()=>{R.value.clearRefreshSelected()})},N=e=>{let a={SubscribeID:e.SubscribeID};l.subscribeSend(a).then(()=>{t.success("操作成功"),R.value.refresh(!0)})},J=s({visible:!1,submitLoading:!1,formData:{},formRules:{SubscribeCancelOrg:[{required:!0,message:"请输入订阅取消单位",trigger:"blur"}],SubscribeCancelPerson:[{required:!0,message:"请输入订阅取消人",trigger:"blur"}]}}),V=()=>{T.value.validate().then(()=>{J.submitLoading=!0,l.subscribeCancel(J.formData).then(()=>{t.success("取消订阅成功"),J.visible=!1,R.value.refresh(!0)}).finally(()=>{J.submitLoading=!1})})},q=()=>{T.value.resetFields(),J.visible=!1};return(r,t)=>{const i=u("a-input"),s=u("a-form-item"),n=u("a-col"),A=u("a-button"),K=u("a-row"),$=u("a-form"),z=u("plus-outlined"),G=e,W=u("a-space"),Y=u("a-tag"),Z=u("a-divider"),H=u("a-popconfirm"),M=u("DownOutlined"),Q=u("a-menu-item"),X=u("a-menu"),ee=u("a-dropdown"),ae=u("s-table"),le=u("a-card"),re=u("a-textarea"),te=u("a-modal");return c(),o(v,null,[d(le,{bordered:!1},{default:b(()=>[d($,{ref_key:"searchFormRef",ref:x,name:"advanced_search",model:m(O),class:"ant-advanced-search-form mb-4"},{default:b(()=>[d(K,{gutter:24},{default:b(()=>[d(n,{span:6},{default:b(()=>[d(s,{label:"订阅标题",name:"Title"},{default:b(()=>[d(i,{value:m(O).Title,"onUpdate:value":t[0]||(t[0]=e=>m(O).Title=e),placeholder:"请输入订阅标题"},null,8,["value"])]),_:1})]),_:1}),d(n,{span:6},{default:b(()=>[d(s,{label:"订阅目标节点",name:"SubscriberRecoverOrgid"},{default:b(()=>[d(i,{value:m(O).SubscriberRecoverOrgid,"onUpdate:value":t[1]||(t[1]=e=>m(O).SubscriberRecoverOrgid=e),placeholder:"请选择订阅目标节点"},null,8,["value"])]),_:1})]),_:1}),d(n,{span:6},{default:b(()=>[d(A,{type:"primary",onClick:t[2]||(t[2]=e=>m(R).refresh(!0))},{default:b(()=>t[11]||(t[11]=[f("查询")])),_:1}),d(A,{style:{margin:"0 8px"},onClick:t[3]||(t[3]=()=>m(x).resetFields())},{default:b(()=>t[12]||(t[12]=[f("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),d(ae,{ref_key:"table",ref:R,columns:U,data:B,alert:F.alert.show,bordered:"","row-key":e=>e.subscribeid,"tool-config":j,"row-selection":F.rowSelection},{operator:b(()=>[d(W,null,{default:b(()=>[r.hasPerm("viidSubscribeDownAdd")?(c(),D(A,{key:0,type:"primary",onClick:t[4]||(t[4]=e=>m(P).onOpen())},{icon:b(()=>[d(z)]),default:b(()=>[t[13]||(t[13]=f(" 新增 "))]),_:1})):S("",!0),r.hasPerm("viidSubscribeBatchDelete")?(c(),D(G,{key:1,buttonName:"批量删除",icon:"DeleteOutlined",selectedRowKeys:m(L),onBatchCallBack:E},null,8,["selectedRowKeys"])):S("",!0)]),_:1})]),bodyCell:b(({column:e,record:a})=>["SubscribeDetail"===e.dataIndex?(c(!0),o(v,{key:0},p(JSON.parse(a.SubscribeDetail),e=>(c(),D(Y,{key:e,color:"processing"},{default:b(()=>[f(g(r.$TOOL.dictTypeData("VIID_Subscribe_Detail_Type",e)),1)]),_:2},1024))),128)):S("",!0),"SubscribeStatus"===e.dataIndex?(c(),o(v,{key:1},[f(g(r.$TOOL.dictTypeData("VIID_Subscribe_Status",a.SubscribeStatus)),1)],64)):S("",!0),"action"===e.dataIndex?(c(),o(v,{key:2},[r.hasPerm("viidSubscribeDownEdit")?(c(),o("a",{key:0,onClick:e=>m(P).onOpen(a)},"编辑",8,y)):S("",!0),r.hasPerm(["viidSubscribeDownEdit","viidSubscribeDownDelete"],"and")?(c(),D(Z,{key:1,type:"vertical"})):S("",!0),d(H,{title:"确定要删除吗？",onConfirm:e=>(e=>{let a=[{SubscribeID:e.SubscribeID}];l.viidSubscribeDelete(a).then(()=>{R.value.refresh(!0)})})(a)},{default:b(()=>[r.hasPerm("viidSubscribeDownDelete")?(c(),D(A,{key:0,type:"link",danger:"",size:"small"},{default:b(()=>t[14]||(t[14]=[f("删除")])),_:1})):S("",!0)]),_:2},1032,["onConfirm"]),d(Z,{type:"vertical"}),d(ee,null,{overlay:b(()=>[d(X,null,{default:b(()=>["0"===a.SubscribeStatus?(c(),D(Q,{key:0},{default:b(()=>[k("a",{onClick:e=>(e=>{J.visible=!0,J.formData={SubscribeID:e.SubscribeID,SubscribeCancelOrg:"",SubscribeCancelPerson:"",CancelTime:null,CancelReason:""}})(a)},"取消订阅",8,h)]),_:2},1024)):S("",!0),d(Q,null,{default:b(()=>["0"===a.SubscribeStatus?(c(),o("a",{key:0,onClick:e=>N(a)},"重载订阅",8,C)):S("",!0),"1"===a.SubscribeStatus?(c(),o("a",{key:1,onClick:e=>N(a)},"订阅",8,I)):S("",!0),"9"===a.SubscribeStatus?(c(),o("a",{key:2,onClick:e=>N(a)},"订阅",8,w)):S("",!0)]),_:2},1024)]),_:2},1024)]),default:b(()=>[k("a",_,[t[15]||(t[15]=f(" 更多 ")),d(M)])]),_:2},1024)],64)):S("",!0)]),_:1},8,["alert","row-key","row-selection"])]),_:1}),d(a,{ref_key:"formRef",ref:P,onSuccessful:t[5]||(t[5]=e=>m(R).refresh(!0))},null,512),d(te,{visible:m(J).visible,"onUpdate:visible":t[10]||(t[10]=e=>m(J).visible=e),title:"取消订阅","confirm-loading":m(J).submitLoading,onOk:V,onCancel:q},{default:b(()=>[d($,{ref_key:"cancelFormRef",ref:T,model:m(J).formData,rules:m(J).formRules,layout:"vertical"},{default:b(()=>[d(s,{label:"订阅编号：",name:"SubscribeID"},{default:b(()=>[d(i,{value:m(J).formData.SubscribeID,"onUpdate:value":t[6]||(t[6]=e=>m(J).formData.SubscribeID=e),readOnly:""},null,8,["value"])]),_:1}),d(s,{label:"订阅取消单位：",name:"SubscribeCancelOrg"},{default:b(()=>[d(i,{value:m(J).formData.SubscribeCancelOrg,"onUpdate:value":t[7]||(t[7]=e=>m(J).formData.SubscribeCancelOrg=e),placeholder:"请输入订阅取消单位"},null,8,["value"])]),_:1}),d(s,{label:"订阅取消人：",name:"SubscribeCancelPerson"},{default:b(()=>[d(i,{value:m(J).formData.SubscribeCancelPerson,"onUpdate:value":t[8]||(t[8]=e=>m(J).formData.SubscribeCancelPerson=e),placeholder:"请输入订阅取消人"},null,8,["value"])]),_:1}),d(s,{label:"取消原因：",name:"CancelReason"},{default:b(()=>[d(re,{value:m(J).formData.CancelReason,"onUpdate:value":t[9]||(t[9]=e=>m(J).formData.CancelReason=e),placeholder:"请输入取消原因",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","confirm-loading"])],64)}}});export{x as default};
