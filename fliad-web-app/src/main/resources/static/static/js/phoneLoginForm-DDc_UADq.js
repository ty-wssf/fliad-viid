import{r as e,a}from"./formRules-B2bzcXv4.js";import{c as l}from"./clientLoginApi-CbOluBR5.js";import{a as o}from"./util-CNugiXN7.js";import{k as t}from"./ant-design-vendor-CRFwT3Wn.js";import{d as n,f as d,a1 as i,U as s,V as u,k as r,a2 as v,u as p,G as m,a3 as c,Y as f,H as h,F as C}from"./vue-vendor-BzDj5Url.js";import"./index-DcffTgQN.js";const _=["src"],g=n({name:"smsLoginForm"}),x=Object.assign(g,{setup(n){const g=d(),x=d({}),k=d(!1);let y=d({time:60,smsSendBtn:!1});const b=d({}),w=d(""),B=()=>{b.value.phone=[e("请输入11位手机号"),a.phone],delete b.value.phoneValidCode,g.value.validate().then(()=>{j.value=!0,U()})},V=async()=>{b.value.phone=[e("请输入11位手机号"),a.phone],b.value.phoneValidCode=[e("请输入短信验证码"),a.number];if(!(await g.value.validate().catch(()=>{})))return!1;x.value.validCode=x.value.phoneValidCode,x.value.validCodeReqNo=w.value,k.value=!0,l.clientLoginByPhone(x.value).then(e=>{o(e)}).finally(()=>{k.value=!1})},j=d(!1),R=d(),S=d({}),z=d("");d("");const L={validCode:[e("请输入图形验证码"),a.lettersNum]},U=()=>{l.clientGetPicCaptcha().then(e=>{z.value=e.validCodeBase64,S.value.validCodeReqNo=e.validCodeReqNo})},F=()=>{j.value=!1},N=()=>{R.value.validate().then(()=>{j.value=!1,S.value.phone=x.value.phone,y.value.smsSendBtn=!0;const e=window.setInterval(()=>{y.value.time--<=0&&(y.value.time=60,y.value.smsSendBtn=!1,window.clearInterval(e))},1e3),a=t.loading("验证码发送中..",0);l.clientGetPhoneValidCode(S.value).then(e=>{w.value=e,j.value=!1,setTimeout(a,500),S.value.validCode=""}).catch(()=>{setTimeout(a,100),clearInterval(e),y.value.smsSendBtn=!1})})};return(e,a)=>{const l=i("mobile-outlined"),o=i("a-input"),t=i("a-form-item"),n=i("mail-outlined"),d=i("a-col"),w=i("a-button"),q=i("a-row"),G=i("a-form"),I=i("verified-outlined"),P=i("a-modal");return u(),s(C,null,[r(G,{ref_key:"phoneLoginFormRef",ref:g,model:p(x),rules:p(b)},{default:v(()=>[r(t,{name:"phone"},{default:v(()=>[r(o,{value:p(x).phone,"onUpdate:value":a[0]||(a[0]=e=>p(x).phone=e),placeholder:"请输入手机号",size:"large"},{prefix:v(()=>[r(l,{class:"text-black text-opacity-25"})]),_:1},8,["value"])]),_:1}),r(t,{name:"phoneValidCode"},{default:v(()=>[r(q,{gutter:8},{default:v(()=>[r(d,{span:16},{default:v(()=>[r(o,{value:p(x).phoneValidCode,"onUpdate:value":a[1]||(a[1]=e=>p(x).phoneValidCode=e),placeholder:"请输入验证码",size:"large"},{prefix:v(()=>[r(n,{class:"text-black text-opacity-25"})]),_:1},8,["value"])]),_:1}),r(d,{span:8},{default:v(()=>[r(w,{size:"large",class:"xn-wd",onClick:B,disabled:p(y).smsSendBtn},{default:v(()=>[m(c(p(y).smsSendBtn?p(y).time+" s":"获取验证码"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),r(t,null,{default:v(()=>[r(w,{type:"primary",class:"xn-wd",loading:p(k),round:"",size:"large",onClick:V},{default:v(()=>a[4]||(a[4]=[m(" 登录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),r(P,{open:p(j),"onUpdate:open":a[3]||(a[3]=e=>h(j)?j.value=e:null),width:400,title:"机器验证",onCancel:F,onOk:N},{default:v(()=>[r(G,{ref_key:"phoneLoginFormModalRef",ref:R,model:p(S),rules:L},{default:v(()=>[r(t,{name:"validCode"},{default:v(()=>[r(q,{gutter:8},{default:v(()=>[r(d,{span:17},{default:v(()=>[r(o,{value:p(S).validCode,"onUpdate:value":a[2]||(a[2]=e=>p(S).validCode=e),placeholder:"请输入验证码",size:"large"},{prefix:v(()=>[r(I,{class:"text-black text-opacity-25"})]),_:1},8,["value"])]),_:1}),r(d,{span:7},{default:v(()=>[f("img",{src:p(z),class:"xn-findform-line",onClick:U},null,8,_)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])],64)}}});export{x as default};
