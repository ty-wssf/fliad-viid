import{_ as e,c as a}from"./index-DcffTgQN.js";import{w as l,k as t,y as n,b as o}from"./ant-design-vendor-CRFwT3Wn.js";import{d as s,f as d,a4 as r,w as u,a1 as i,U as c,V as v,Z as p,k as f,a6 as y,F as g,W as h,a2 as m,G as k,a3 as _,u as b,X as I,H as w,Y as x}from"./vue-vendor-BzDj5Url.js";const C={key:0},A={key:0},L={class:"table-operator xn-mb10"},z={class:"selector-table"},B={key:0,class:"xn-fdr"},O={class:"mt-2"},T={class:"selector-table"},P={key:0,class:"xn-fdr"},E=s({name:"roleSelector"}),G=e(Object.assign(E,{props:{radioModel:{type:Boolean,default:()=>!1},dataIsConverterFlw:{type:Boolean,default:()=>!1},orgTreeApi:{type:Function},rolePageApi:{type:Function},roleListByIdListApi:{type:Function},value:{default:()=>""},dataType:{type:String,default:()=>"array"},show:{type:Boolean,default:()=>!0},addShow:{type:Boolean,default:()=>!0},roleGlobal:{type:Boolean,default:!0,required:!1}},emits:["update:value","onBack"],setup(e,{expose:s,emit:E}){const G=d(!1),F=[{title:"操作",dataIndex:"action",align:"center",width:50},{title:"名称",dataIndex:"name",ellipsis:!0},{title:"分类",dataIndex:"category"}],M=[{title:"操作",dataIndex:"action",align:"center",width:50},{title:"名称",dataIndex:"name",ellipsis:!0}],S=e,K=d(),R=d(),U=d(),j=d({}),D=d(),Y=d(!0),$=d(!1),q=d(!1),H=r(),J={children:"children",title:"name",key:"id"},V=d(),W=d([]),X=E,Z=d([]),N=d([]),Q=d([]),ee=d(0),ae=d(10),le=d(0),te=e=>"function"==typeof S.roleListByIdListApi?S.roleListByIdListApi(e):a.userCenterGetRoleListByIdList(e).then(e=>Promise.resolve(e)),ne=()=>{if("function"!=typeof S.orgTreeApi||"function"!=typeof S.rolePageApi)return void t.warning("未配置角色选择器API");if(G.value=!0,(e=>"function"==typeof S.orgTreeApi?S.orgTreeApi(e):(t.warning("未配置机构树API"),Promise.resolve([])))().then(e=>{if(!l(e)){if(V.value=e,S.roleGlobal){const a=[{id:"GLOBAL",parentId:"-1",name:"全局"}];V.value=a.concat(e)}V.value.forEach(e=>{"0"===e.parentId&&(W.value.push(e.id),e.children&&e.children.forEach(e=>{W.value.push(e.id)}))})}}).finally(()=>{Y.value=!1}),j.value.size=ae.value,oe(),l(Q.value))return;const e={idList:Q.value};q.value=!0,te(e).then(e=>{N.value=e}).finally(()=>{q.value=!1})},oe=()=>{var e;S.roleGlobal||(j.value.category="ORG"),$.value=!0,(e=j.value,"function"==typeof S.rolePageApi?S.rolePageApi(e):(t.warning("未配置角色选择器API"),Promise.resolve([]))).then(e=>{ee.value=e.current,le.value=e.total,Z.value=[],U.value=0,Z.value=e.records,e.records?U.value=e.records.length:U.value=0}).finally(()=>{$.value=!1})},se=(e,a)=>{j.value.current=e,j.value.size=a,oe()},de=e=>{if(S.radioModel&&N.value.length>0)return void t.warning("只可选择一条");0===N.value.filter(a=>a.id===e.id).length?N.value.push(e):t.warning("该记录已存在")},re=()=>{let e=N.value.concat(Z.value),a=[];for(let l of e){let e=!0;for(let t of a)l.id===t.id&&(e=!1);e&&a.push(l)}N.value=a},ue=()=>{N.value=[]},ie=e=>{j.value.current=0,e.length>0?"GLOBAL"===e[0]?(j.value.category=e[0],delete j.value.orgId):(j.value.orgId=e.toString(),delete j.value.category):(delete j.value.category,delete j.value.orgId),oe()},ce=d([]),ve=()=>{ce.value=[];const e=[],a=[];N.value.forEach(l=>{const t={id:l.id,name:l.name};e.push(l.id);const n=o(t);a.push(n)}),ce.value=a;const l=ye(e);X("update:value",l),X("onBack",l),pe()},pe=()=>{j.value={},U.value=0,Z.value=[],ee.value=0,ae.value=20,le.value=0,N.value=[],G.value=!1},fe=e=>{if(S.dataIsConverterFlw){const a=[];if(l(e.value)){if(!l(e)&&!l(e[0])&&!l(e[0].value)){const l=e[0].value.split(",");for(let e=0;e<l.length;e++)a.push(l[e])}}else{const l=e.value.split(",");l.length>0?l.forEach(e=>{a.push(e)}):a.push(e.value)}return a}if("string"!==ge())return e;if(e.length>1){const a=[];return e.split(",").forEach(e=>{a.push(e)}),a}return e},ye=e=>{if(S.dataIsConverterFlw){e=ce.value;const a={};let l="",t="";for(let n=0;n<e.length;n++)e.length===n+1?(l+=e[n].name,t+=e[n].id):(l=l+e[n].name+",",t=t+e[n].id+",");return a.key="ROLE",a.label=l,a.value=t,a.extJson="",a}{if("string"!==ge())return e;let a="";return e.forEach(e=>{a=a+","+e}),a=a.substring(1,a.length),a}},ge=()=>S.dataType?S.dataType:S.radioModel?"string":typeof typeof S.value,he=e=>{if(l(ce.value)&&!l(e)){const e={idList:Q.value};te(e).then(e=>{ce.value=e})}};return u(()=>S.value,e=>{if(l(S.value))ce.value=[],N.value=[];else{const a=fe(e);Q.value=a,he(a)}},{immediate:!0}),s({showModel:(e=[])=>{const a=fe(e);Q.value=a,he(a),ne()}}),(a,t)=>{const s=i("a-tag"),d=i("plus-outlined"),r=i("a-button"),u=i("a-tree"),E=i("a-card"),te=i("a-col"),fe=i("a-input"),ge=i("a-form-item"),he=i("a-row"),me=i("a-form"),ke=i("PlusOutlined"),_e=i("a-table"),be=i("a-pagination"),Ie=i("MinusOutlined"),we=i("a-modal");return v(),c(g,null,[S.show?(v(),c("div",C,[(v(!0),c(g,null,h(b(ce),e=>(v(),y(s,{closable:"",onClose:a=>(e=>{n(ce.value,a=>a.id===e.id),n(Q.value,a=>a===e.id);const a=[],l=[];ce.value.forEach(e=>{const t={id:e.id,name:e.name};a.push(e.id);const n=o(t);l.push(n)}),ce.value=l;const t=ye(a);X("update:value",t),X("onBack",t)})(e),key:e.id,class:"mb-1"},{default:m(()=>[k(_(e.name),1)]),_:2},1032,["onClose"]))),128)),S.radioModel&&1===b(ce).length||!e.addShow?p("",!0):(v(),y(r,{key:0,type:"primary",size:"small",onClick:ne},{default:m(()=>{return[I(a.$slots,"button",{},void 0,!0),(e="button",H[e]&&H[e]().length>0?p("",!0):(v(),c("span",A,[f(d),t[7]||(t[7]=k(" 选择 "))])))];var e}),_:3}))])):p("",!0),f(we,{open:b(G),"onUpdate:open":t[6]||(t[6]=e=>w(G)?G.value=e:null),title:"角色选择",width:1e3,"mask-closable":!1,"destroy-on-close":!0,onOk:ve,onCancel:pe},{default:m(()=>[f(he,{gutter:10},{default:m(()=>[f(te,{span:7},{default:m(()=>[f(E,{size:"small",loading:b(Y),class:"selectorTreeDiv"},{default:m(()=>[b(V)?(v(),y(u,{key:0,expandedKeys:b(W),"onUpdate:expandedKeys":t[0]||(t[0]=e=>w(W)?W.value=e:null),"tree-data":b(V),"field-names":J,onSelect:ie},null,8,["expandedKeys","tree-data"])):p("",!0)]),_:1},8,["loading"])]),_:1}),f(te,{span:11},{default:m(()=>[x("div",L,[f(me,{ref_key:"searchFormRef",ref:D,name:"advanced_search",class:"ant-advanced-search-form",model:b(j)},{default:m(()=>[f(he,{gutter:24},{default:m(()=>[f(te,{span:12},{default:m(()=>[f(ge,{name:"searchKey"},{default:m(()=>[f(fe,{value:b(j).searchKey,"onUpdate:value":t[1]||(t[1]=e=>b(j).searchKey=e),placeholder:"请输入职位名"},null,8,["value"])]),_:1})]),_:1}),f(te,{span:12},{default:m(()=>[f(r,{type:"primary",class:"xn-mr-10",onClick:t[2]||(t[2]=e=>oe())},{default:m(()=>t[8]||(t[8]=[k(" 查询 ")])),_:1}),f(r,{onClick:t[3]||(t[3]=e=>(delete j.value.searchKey,void oe()))},{default:m(()=>t[9]||(t[9]=[k(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),x("div",z,[f(_e,{ref_key:"tableRef",ref:K,size:"small",columns:F,"data-source":b(Z),"expand-row-by-click":!0,loading:b($),bordered:"",pagination:!1},{title:m(()=>[x("span",null,"待选择列表 "+_(b(U))+" 条",1),e.radioModel?p("",!0):(v(),c("div",B,[f(r,{type:"dashed",size:"small",onClick:re},{default:m(()=>t[10]||(t[10]=[k("添加当前数据")])),_:1})]))]),bodyCell:m(({column:e,record:l})=>["action"===e.dataIndex?(v(),y(r,{key:0,type:"dashed",size:"small",onClick:e=>de(l)},{default:m(()=>[f(ke)]),_:2},1032,["onClick"])):p("",!0),"category"===e.dataIndex?(v(),c(g,{key:1},[k(_(a.$TOOL.dictTypeData("ROLE_CATEGORY",l.category)),1)],64)):p("",!0)]),_:1},8,["data-source","loading"]),x("div",O,[b(l)(b(Z))?p("",!0):(v(),y(be,{key:0,current:b(ee),"onUpdate:current":t[4]||(t[4]=e=>w(ee)?ee.value=e:null),"page-size":b(ae),"onUpdate:pageSize":t[5]||(t[5]=e=>w(ae)?ae.value=e:null),total:b(le),size:"small",showSizeChanger:"",onChange:se},null,8,["current","page-size","total"]))])])]),_:1}),f(te,{span:6},{default:m(()=>[x("div",T,[f(_e,{ref_key:"selectedTable",ref:R,size:"small",columns:M,"data-source":b(N),"expand-row-by-click":!0,loading:b(q),bordered:""},{title:m(()=>[x("span",null,"已选择: "+_(b(N).length),1),e.radioModel?p("",!0):(v(),c("div",P,[f(r,{type:"dashed",danger:"",size:"small",onClick:ue},{default:m(()=>t[11]||(t[11]=[k("全部移除")])),_:1})]))]),bodyCell:m(({column:e,record:a})=>["action"===e.dataIndex?(v(),y(r,{key:0,type:"dashed",danger:"",size:"small",onClick:e=>(e=>{n(N.value,a=>a.id===e.id)})(a)},{default:m(()=>[f(Ie)]),_:2},1032,["onClick"])):p("",!0)]),_:1},8,["data-source","loading"])])]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),[["__scopeId","data-v-b01663a5"]]);export{G as _};
