import{g as e,f as a,c as l,o,a5 as s,U as r,Y as u,ag as n,a3 as t,k as d,a2 as i,a1 as v,ac as c,V as _,a6 as g,Z as p,ah as f,G as S}from"./vue-vendor-BzDj5Url.js";import{r as m,a as C}from"./formRules-B2bzcXv4.js";import{_ as Y,g as P,D as w,t as O,l as h}from"./index-DcffTgQN.js";import{s as N}from"./smCrypto-fJLAcgxS.js";import{c as y}from"./configApi-BMiyCPj3.js";import{w as R,b as E,k as A}from"./ant-design-vendor-CRFwT3Wn.js";const W={class:"login-wrapper"},L={class:"login_background"},F={class:"logo_background"},$=["href"],b=["alt","src"],G={class:"version"},T={class:"login_main"},k={class:"login-form"},x={class:"login-header",style:{"margin-bottom":"20px"}},I=["src"],U={style:{display:"flex","justify-content":"flex-end"}},B={href:"/login",class:"xn-color-0d84ff"},D=Y({__name:"register",setup(Y){const{proxy:D}=e(),j=s(),q=c(),H=a(!1),z=a(),V=a(!1),K=P(),M=K.setSysBaseConfig,Z=l(()=>K.sysBaseConfig),J=a({account:"",password:"",newPassword:"",validCode:"",validCodeReqNo:""}),Q=a({account:[m(D.$t("login.accountPlaceholder"))],password:[m(D.$t("login.PWPlaceholder")),{validator:(e,a)=>a&&J.value.newPassword&&a!==J.value.newPassword?Promise.reject(D.$t("login.enteredPasswordsDiffer")):Promise.resolve(),trigger:["change","blur"]}],newPassword:[m(D.$t("login.enterAgainPassword")),{validator:(e,a)=>a&&J.value.password&&a!==J.value.password?Promise.reject(D.$t("login.enteredPasswordsDiffer")):Promise.resolve(),trigger:["change","blur"]}]}),X=a(w.SYS_BASE_CONFIG.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN_FLAG_FOR_B),ee=a("false"),ae=a("");o(()=>{R(j.query.tenCode)||(J.value.tenCode=j.query.tenCode),V.value=!0,O.data.set("SNOWY_TEN_CODE",""),le()});const le=()=>{let e=a(w.SYS_BASE_CONFIG);y.configSysBaseList().then(a=>{V.value=!1,a&&(a.forEach(a=>{e.value[a.configKey]=a.configValue}),X.value=e.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN_FLAG_FOR_B,ee.value=e.value.SNOWY_SYS_DEFAULT_ALLOW_REGISTER_FLAG_FOR_B,O.data.set("SNOWY_SYS_BASE_CONFIG",e.value),M(e.value),oe())}).catch(()=>{})},oe=()=>{"true"===X.value&&(re(),Q.value.validCode=[m(D.$t("login.validError"),"blur"),C.lettersNum])},se=()=>{Q.value.validCode=[m(D.$t("login.validError")),C.lettersNum],z.value.validate().then(()=>{V.value=!1,H.value=!0;const e={account:J.value.account,password:N.doSm2Encrypt(E(J.value.password)),validCode:J.value.validCode,validCodeReqNo:J.value.validCodeReqNo};h.register(e).then(()=>{q.replace({path:"/login"}),A.success("注册成功")}).catch(()=>{"true"===X.value&&re()}).finally(()=>{H.value=!1})}).catch(()=>{})},re=()=>{h.getPicCaptcha().then(e=>{ae.value=e.validCodeBase64,J.value.validCodeReqNo=e.validCodeReqNo,J.value.validCode=void 0})},ue=e=>{Z.value.SNOWY_SYS_COPYRIGHT_URL||(null==e||e.stopPropagation(),null==e||e.preventDefault())};return(e,a)=>{const l=v("user-outlined"),o=v("a-input"),s=v("a-form-item"),c=v("lock-outlined"),m=v("a-input-password"),C=v("verified-outlined"),Y=v("a-col"),P=v("a-row"),w=v("a-button"),O=v("a-form"),h=v("a-card");return _(),r("div",W,[u("div",L,[u("div",F,[u("a",{class:n({"no-link":!Z.value.SNOWY_SYS_COPYRIGHT_URL}),href:Z.value.SNOWY_SYS_COPYRIGHT_URL,target:"_blank",onClick:ue},[u("img",{alt:Z.value.SNOWY_SYS_NAME,src:Z.value.SNOWY_SYS_LOGO},null,8,b),u("label",null,t(Z.value.SNOWY_SYS_NAME),1)],10,$)]),u("div",G,[u("p",null,t(Z.value.SNOWY_SYS_DEFAULT_DESCRRIPTION),1),u("p",null,t(Z.value.SNOWY_SYS_COPYRIGHT)+" "+t(Z.value.SNOWY_SYS_VERSION),1)])]),u("div",T,[u("div",k,[d(h,null,{default:i(()=>[u("div",x,[u("h2",null,t(e.$t("login.userRegister")),1)]),d(O,{ref_key:"registerFormRef",ref:z,model:J.value,rules:Q.value,class:"user-box",autocomplete:"off"},{default:i(()=>[d(s,{name:"account"},{default:i(()=>[d(o,{value:J.value.account,"onUpdate:value":a[0]||(a[0]=e=>J.value.account=e),placeholder:e.$t("login.accountPlaceholder"),size:"large"},{prefix:i(()=>[d(l,{class:"login-icon-gray"})]),_:1},8,["value","placeholder"])]),_:1}),d(s,{name:"password"},{default:i(()=>[d(m,{value:J.value.password,"onUpdate:value":a[1]||(a[1]=e=>J.value.password=e),placeholder:e.$t("login.PWPlaceholder"),size:"large"},{prefix:i(()=>[d(c,{class:"login-icon-gray"})]),_:1},8,["value","placeholder"])]),_:1}),d(s,{name:"newPassword"},{default:i(()=>[d(m,{value:J.value.newPassword,"onUpdate:value":a[2]||(a[2]=e=>J.value.newPassword=e),placeholder:e.$t("login.enterAgainPassword"),size:"large"},{prefix:i(()=>[d(c,{class:"login-icon-gray"})]),_:1},8,["value","placeholder"])]),_:1}),"true"===X.value?(_(),g(s,{key:0,name:"validCode"},{default:i(()=>[d(P,{gutter:8},{default:i(()=>[d(Y,{span:17},{default:i(()=>[d(o,{value:J.value.validCode,"onUpdate:value":a[3]||(a[3]=e=>J.value.validCode=e),placeholder:e.$t("login.validError"),size:"large",onKeyup:f(se,["enter"])},{prefix:i(()=>[d(C,{class:"login-icon-gray"})]),_:1},8,["value","placeholder"])]),_:1}),d(Y,{span:7},{default:i(()=>[u("img",{src:ae.value,class:"login-validCode-img",onClick:re},null,8,I)]),_:1})]),_:1})]),_:1})):p("",!0),d(s,null,{default:i(()=>[d(w,{type:"primary",class:"w-full",loading:H.value,round:"",size:"large",onClick:se,disabled:V.value},{default:i(()=>[S(t(e.$t("login.register")),1)]),_:1},8,["loading","disabled"])]),_:1}),u("div",U,[u("a",B,t(e.$t("login.haveAccountPleaseLogin")),1)])]),_:1},8,["model","rules"])]),_:1})])])])}}},[["__scopeId","data-v-d91e7f90"]]);export{D as default};
