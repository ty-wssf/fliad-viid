import{r as e,a}from"./formRules-B2bzcXv4.js";import{l}from"./index-DcffTgQN.js";import{a as i}from"./login-Cg0fTS5R.js";import{k as t}from"./ant-design-vendor-CRFwT3Wn.js";import{d as o,g as d,f as n,a1 as s,U as r,V as u,k as m,a2 as v,u as c,G as p,a3 as f,Y as g,H as C,F as h}from"./vue-vendor-BzDj5Url.js";import"./smCrypto-fJLAcgxS.js";import"./configApi-BMiyCPj3.js";import"./keepAlive-BXK4dPiU.js";const _=["src"],x=o({name:"emailLoginForm"}),k=Object.assign(x,{setup(o){const{proxy:x}=d(),k=n(),y=n({}),V=n(!1);let $=n({time:60,smsSendBtn:!1}),j=n({});const w=n(""),b=()=>{j.value.email=[e(x.$t("login.emailValidPlaceholder")),a.email],delete j.value.emailValidCode,k.value.validate().then(()=>{E.value=!0,U()})},B=async()=>{j.value.email=[e(x.$t("login.emailValidPlaceholder")),a.email],j.value.emailValidCode=[e(x.$t("login.emailCodePlaceholder")),a.number];if(!(await k.value.validate().catch(()=>{})))return!1;y.value.validCode=y.value.emailValidCode,y.value.validCodeReqNo=w.value,V.value=!0,l.loginByEmail(y.value).then(e=>{i(e)}).finally(()=>{V.value=!1})},E=n(!1),R=n(),S=n({}),z=n("");n("");const P={validCode:[e(x.$t("login.validError")),a.lettersNum]},U=()=>{l.getPicCaptcha().then(e=>{z.value=e.validCodeBase64,S.value.validCodeReqNo=e.validCodeReqNo})},F=()=>{E.value=!1},I=()=>{R.value.validate().then(()=>{E.value=!1,S.value.email=y.value.email,$.value.smsSendBtn=!0;const e=window.setInterval(()=>{$.value.time--<=0&&($.value.time=60,$.value.smsSendBtn=!1,window.clearInterval(e))},1e3),a=t.loading("验证码发送中..",0);l.getEmailValidCode(S.value).then(e=>{w.value=e,E.value=!1,setTimeout(a,500),S.value.validCode=""}).catch(()=>{setTimeout(a,100),clearInterval(e),$.value.smsSendBtn=!1})})};return(e,a)=>{const l=s("mail-outlined"),i=s("a-input"),t=s("a-form-item"),o=s("a-col"),d=s("a-button"),n=s("a-row"),x=s("a-form"),w=s("verified-outlined"),N=s("a-modal");return u(),r(h,null,[m(x,{ref_key:"emailLoginFormRef",ref:k,model:c(y),rules:c(j)},{default:v(()=>[m(t,{name:"email"},{default:v(()=>[m(i,{value:c(y).email,"onUpdate:value":a[0]||(a[0]=e=>c(y).email=e),placeholder:e.$t("login.emailPlaceholder"),size:"large"},{prefix:v(()=>[m(l,{class:"text-black text-opacity-25"})]),_:1},8,["value","placeholder"])]),_:1}),m(t,{name:"emailValidCode"},{default:v(()=>[m(n,{gutter:8},{default:v(()=>[m(o,{span:16},{default:v(()=>[m(i,{value:c(y).emailValidCode,"onUpdate:value":a[1]||(a[1]=e=>c(y).emailValidCode=e),placeholder:e.$t("login.validError"),size:"large"},{prefix:v(()=>[m(l,{class:"text-black text-opacity-25"})]),_:1},8,["value","placeholder"])]),_:1}),m(o,{span:8},{default:v(()=>[m(d,{size:"large",class:"xn-wd",onClick:b,disabled:c($).smsSendBtn},{default:v(()=>[p(f(!c($).smsSendBtn&&e.$t("login.getEmailCode")||c($).time+" s"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),m(t,null,{default:v(()=>[m(d,{type:"primary",class:"xn-wd",loading:c(V),round:"",size:"large",onClick:B},{default:v(()=>[p(f(e.$t("login.signIn")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),m(N,{open:c(E),"onUpdate:open":a[3]||(a[3]=e=>C(E)?E.value=e:null),width:400,title:e.$t("login.machineValidation"),onCancel:F,onOk:I},{default:v(()=>[m(x,{ref_key:"emailLoginFormModalRef",ref:R,model:c(S),rules:P},{default:v(()=>[m(t,{name:"validCode"},{default:v(()=>[m(n,{gutter:8},{default:v(()=>[m(o,{span:17},{default:v(()=>[m(i,{value:c(S).validCode,"onUpdate:value":a[2]||(a[2]=e=>c(S).validCode=e),placeholder:e.$t("login.validError"),size:"large"},{prefix:v(()=>[m(w,{class:"text-black text-opacity-25"})]),_:1},8,["value","placeholder"])]),_:1}),m(o,{span:7},{default:v(()=>[g("img",{src:c(z),class:"xn-findform-line",onClick:U},null,8,_)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])],64)}}});export{k as default};
