import{d as e,f as a,w as l,a1 as n,a6 as u,V as t,a2 as o,u as r,H as s,n as c}from"./vue-vendor-BzDj5Url.js";const i=e({name:"xnPageSelector"}),d=Object.assign(i,{props:{value:{type:String,default:()=>{}},placeholder:{type:String,default:()=>"请选择"},pageFunction:{type:Function},echoFunction:{type:Function},pageSize:{type:Number,default:()=>10},allowClear:{type:Boolean,default:()=>!1},showSearch:{type:Boolean,default:()=>!1},searchKeyName:{type:String,default:()=>""},disabled:{type:Boolean,default:()=>!1}},emits:{change:null,"update:value":null,search:null},setup(e,{expose:i,emit:d}){const p=a(0),v=a({}),h=a([]),f=a(!1),g=d,y=e,m=a(y.value);l(y,e=>{m.value=e.value});const w=(e={})=>{y.pageFunction&&(v.value={...v.value,...e,size:y.pageSize},f.value=!0,v.value.current=1,y.pageFunction(v.value).then(e=>{v.value.current=e.current,p.value=e.total,h.value=e.records,S()}).finally(()=>{f.value=!1}))},S=()=>{y.echoFunction&&c(()=>{if(m.value){if(!h.value.find(e=>e.id===m.value)){const e={idList:[m.value]};y.echoFunction(e).then(e=>{e[0]&&h.value.unshift(e[0])})}}})},b=(e,a)=>{m.value=e,null==e&&y.showSearch&&(v.value[y.searchKeyName]=e),g("update:value",e),g("change",e,a)},F=e=>{let a={current:1};y.searchKeyName&&""!==y.searchKeyName&&(a[y.searchKeyName]=e,w({...v.value,...a})),g("search",e)},O=e=>{const{target:a}=e,{scrollTop:l,scrollHeight:n,clientHeight:u}=a;l+2+u>=n&&N()},N=()=>{if(h.value.length<p.value){const e={...v.value,current:v.value.current+1};f.value=!0,y.pageFunction(e).then(e=>{if(e.records.length>0){v.value.current=e.current;const a=[...h.value,...e.records].reduce((e,a)=>(e[a.id]=a,e),{});h.value=Object.values(a)}}).finally(()=>{f.value=!1})}};return i({onPage:w}),(e,a)=>{const l=n("a-select"),c=n("a-spin");return t(),u(c,{size:"small",spinning:r(f)},{default:o(()=>[y.showSearch?(t(),u(l,{key:0,value:r(m),"onUpdate:value":a[0]||(a[0]=e=>s(m)?m.value=e:null),options:r(h),"field-names":{label:"name",value:"id"},class:"xn-wd",placeholder:y.placeholder,"allow-clear":y.allowClear,disabled:y.disabled,filterOption:!y.showSearch,"show-search":"",onChange:b,onSearch:F,onPopupScroll:O},null,8,["value","options","placeholder","allow-clear","disabled","filterOption"])):(t(),u(l,{key:1,value:r(m),"onUpdate:value":a[1]||(a[1]=e=>s(m)?m.value=e:null),options:r(h),"field-names":{label:"name",value:"id"},class:"xn-wd",placeholder:y.placeholder,"allow-clear":y.allowClear,disabled:y.disabled,filterOption:!y.showSearch,onChange:b,onOnSearch:F,onPopupScroll:O},null,8,["value","options","placeholder","allow-clear","disabled","filterOption"]))]),_:1},8,["spinning"])}}});export{d as _};
