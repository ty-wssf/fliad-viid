import{_ as e,c as a}from"./index-DcffTgQN.js";import{r as l,a as o}from"./formRules-B2bzcXv4.js";import{F as d,I as n,B as t,k as s}from"./ant-design-vendor-CRFwT3Wn.js";import{d as u,f as i,r as v,a1 as r,a6 as p,V as c,a2 as h,k as f,u as m,U as C,Z as _,G as y,a3 as g}from"./vue-vendor-BzDj5Url.js";const B=["src"],V=u({name:"bindPhone"}),w=e(Object.assign(V,{setup(e,{expose:u}){const V=i(!1),w=i(!1),k=i(!1),I=i(""),R=i(""),q=i(""),b=i("");let j=i({time:60,sendBtn:!1});const N=i(),P=v({phone:"",validCode:"",phoneValidCode:"",validCodeReqNo:""}),U=()=>{k.value=!0;try{a.userGetPicCaptcha().then(e=>{I.value=e.validCodeBase64,R.value=e.validCodeReqNo})}finally{k.value=!1}},x=async()=>{try{if(!P.phone)return void s.error("请输入手机号");if(!P.validCode)return void s.error("请输入图片验证码");const e=s.loading("验证码发送中..",0);a.userBindPhoneGetPhoneValidCode({phone:P.phone,validCode:P.validCode,validCodeReqNo:R.value},b.value).then(e=>{j.value.sendBtn=!0;const a=window.setInterval(()=>{j.value.time--<=0&&(j.value.time=60,j.value.sendBtn=!1,window.clearInterval(a))},1e3);q.value=e,s.success("验证码已发送到手机")}).catch(()=>{P.validCode="",P.validCodeReqNo="",q.value="",U()}).finally(()=>{setTimeout(e,100)})}catch(e){U()}},G=async()=>{try{await N.value.validate(),w.value=!0,a.userBindPhone({phone:P.phone,validCode:P.phoneValidCode,validCodeReqNo:q.value}).then(()=>{s.success("绑定成功"),V.value=!1}).catch(()=>{P.phoneValidCode="",q.value=""})}catch(e){}finally{w.value=!1}},F={phone:[l("请输入手机号"),o.phone],validCode:l("请输入图片验证码"),phoneValidCode:[{required:!0,message:"请输入短信验证码",trigger:"blur"}]},O=()=>{V.value=!1,N.value.resetFields(),b.value=""};return u({open:e=>{e&&(P.phone=e,b.value=e),V.value=!0,U()}}),(e,a)=>{const l=r("a-col"),o=r("a-row"),s=r("a-modal");return c(),p(s,{open:V.value,"onUpdate:open":a[3]||(a[3]=e=>V.value=e),title:b.value?"修改手机":"绑定手机",width:400,onOk:G,"destroy-on-close":!0,onCancel:O},{default:h(()=>[f(m(d),{ref_key:"formRef",ref:N,model:P,rules:F,layout:"vertical"},{default:h(()=>[f(m(d).Item,{name:"phone"},{default:h(()=>[f(m(n),{value:P.phone,"onUpdate:value":a[0]||(a[0]=e=>P.phone=e),placeholder:"请输入手机号"},null,8,["value"])]),_:1}),f(m(d).Item,{name:"validCode"},{default:h(()=>[f(o,{gutter:8},{default:h(()=>[f(l,{span:16},{default:h(()=>[f(m(n),{value:P.validCode,"onUpdate:value":a[1]||(a[1]=e=>P.validCode=e),placeholder:"请输入图片验证码"},null,8,["value"])]),_:1}),f(l,{span:8},{default:h(()=>[I.value?(c(),C("img",{key:0,src:I.value,class:"captcha-image",onClick:U},null,8,B)):_("",!0)]),_:1})]),_:1})]),_:1}),f(m(d).Item,{name:"phoneValidCode"},{default:h(()=>[f(o,{gutter:8},{default:h(()=>[f(l,{span:16},{default:h(()=>[f(m(n),{value:P.phoneValidCode,"onUpdate:value":a[2]||(a[2]=e=>P.phoneValidCode=e),placeholder:"请输入短信验证码"},null,8,["value"])]),_:1}),f(l,{span:8},{default:h(()=>[f(m(t),{loading:k.value,onClick:x,style:{width:"100%"},disabled:m(j).sendBtn},{default:h(()=>[y(g(m(j).sendBtn?m(j).time+" s":"获取验证码"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),[["__scopeId","data-v-0c94fd42"]]);export{w as default};
