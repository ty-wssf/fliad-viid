const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/phoneLoginForm-DZo4hidH.js","static/js/formRules-B2bzcXv4.js","static/js/index-DcffTgQN.js","static/js/vue-vendor-BzDj5Url.js","static/js/ant-design-vendor-CRFwT3Wn.js","static/css/index-5e_7XRvV.css","static/js/smCrypto-fJLAcgxS.js","static/js/configApi-BMiyCPj3.js","static/js/keepAlive-BXK4dPiU.js","static/js/emailLoginForm-Ch2ltQJA.js"])))=>i.map(i=>d[i]);
import{u as a,t as e,d as l,b as t,e as o,r as s,c as n,g as r,v as i,l as d,D as u,f as c}from"./index-DcffTgQN.js";import{g as _,f as g,r as v,c as S,o as p,D as f,w as m,U as O,Y as E,u as A,ag as N,a3 as h,k as L,a2 as Y,a1 as C,V as y,H as P,a6 as T,Z as I,ah as b,G as R,a0 as W}from"./vue-vendor-BzDj5Url.js";import{s as w}from"./smCrypto-fJLAcgxS.js";import{r as F}from"./formRules-B2bzcXv4.js";import{k as G}from"./ant-design-vendor-CRFwT3Wn.js";import{c as U}from"./configApi-BMiyCPj3.js";import{k,i as D}from"./keepAlive-BXK4dPiU.js";const $=async r=>{const i=a();e.data.set("TOKEN",r),await l().initUserInfo(),await i.fetchMenu();const d=e.data.get("MENU");let u=t.getIndexMenu(d).path;if(e.data.set("SNOWY_MENU_MODULE_ID",d[0].id),G.success("登录成功"),e.data.get("LAST_VIEWS_PATH")&&(u=e.data.get("LAST_VIEWS_PATH")),d){let a=0;d.forEach(e=>{e.children&&JSON.stringify(e.children).indexOf(u)>-1&&a++}),0===a&&(u=t.getIndexMenu(d).path)}o.dictTree().then(a=>{e.data.set("DICT_TYPE_TREE_DATA",a)}),await s.replace({path:u}),n.userCenterIsUserPasswordExpired().then(a=>{a&&G.warning("当前登录密码已过期，请及时更改！")})},j={class:"login-wrapper"},B={class:"login_background"},H={class:"logo_background"},M=["href"],x=["alt","src"],K={class:"version"},V={class:"login_main"},z={class:"login-form"},q={class:"login-header"},J=["src"],Z={__name:"login",setup(a){const l=W(()=>c(()=>import("./phoneLoginForm-DZo4hidH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),t=W(()=>c(()=>import("./emailLoginForm-Ch2ltQJA.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))),{proxy:o}=_(),s=g("userAccount"),n=g(u.SYS_BASE_CONFIG.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN_FLAG_FOR_B),G=g("false"),Z=g("false"),Q=g("false"),X=g(""),aa=g(!1),ea=v({validCode:"",validCodeReqNo:"",autologin:!1}),la=v({account:[F(o.$t("login.accountError"),"blur")],password:[F(o.$t("login.PWError"),"blur")]});g([{name:"简体中文",value:"zh-cn"},{name:"English",value:"en"}]);const ta=g({lang:e.data.get("APP_LANG")||o.$CONFIG.LANG,theme:e.data.get("APP_THEME")||"default"}),oa=r(),sa=k(),na=D(),ra=i(),ia=oa.setSysBaseConfig,da=sa.clearKeepLive,ua=na.clearIframeList,ca=ra.clearViewTags,_a=S(()=>oa.sysBaseConfig);p(()=>{let a=g(u.SYS_BASE_CONFIG);U.configSysBaseList().then(l=>{l&&(l.forEach(e=>{a.value[e.configKey]=e.configValue}),n.value=a.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN,G.value=a.value.SNOWY_SYS_DEFAULT_ALLOW_REGISTER_FLAG_FOR_B,Z.value=a.value.SNOWY_SYS_DEFAULT_ALLOW_PHONE_LOGIN_FLAG_FOR_B,Q.value=a.value.SNOWY_SYS_DEFAULT_ALLOW_EMAIL_LOGIN_FLAG_FOR_B,e.data.set("SNOWY_SYS_BASE_CONFIG",a.value),ia(a.value),ga())}).catch(()=>{})}),f(()=>{ca(),da(),ua()}),m(()=>ta.value.lang,a=>{o.$i18n.locale=a,e.data.set("APP_LANG",a)}),m(()=>ta.value.theme,a=>{document.body.setAttribute("data-theme",a)});const ga=()=>{"true"===n.value&&(va(),la.validCode=[F(o.$t("login.validError"),"blur")])},va=()=>{d.getPicCaptcha().then(a=>{X.value=a.validCodeBase64,ea.validCodeReqNo=a.validCodeReqNo})},Sa=g(),pa=async()=>{Sa.value.validate().then(async()=>{aa.value=!0;const a={account:ea.account,password:w.doSm2Encrypt(ea.password),validCode:ea.validCode,validCodeReqNo:ea.validCodeReqNo};try{const e=await d.login(a);await $(e)}catch(e){aa.value=!1,"true"===n.value&&va()}}).catch(()=>{})},fa=a=>{_a.value.SNOWY_SYS_COPYRIGHT_URL||(null==a||a.stopPropagation(),null==a||a.preventDefault())};return(a,e)=>{const o=C("UserOutlined"),r=C("a-input"),i=C("a-form-item"),d=C("LockOutlined"),u=C("a-input-password"),c=C("verified-outlined"),_=C("a-col"),g=C("a-row"),v=C("a-button"),S=C("a-form"),p=C("a-tab-pane"),f=C("a-tabs"),m=C("a-card");return y(),O("div",j,[E("div",B,[e[4]||(e[4]=E("div",{class:"overlay"},null,-1)),E("div",H,[E("a",{class:N({"no-link":!A(_a).SNOWY_SYS_COPYRIGHT_URL}),href:A(_a).SNOWY_SYS_COPYRIGHT_URL,target:"_blank",onClick:fa},[E("img",{alt:A(_a).SNOWY_SYS_NAME,src:A(_a).SNOWY_SYS_LOGO},null,8,x),E("label",null,h(A(_a).SNOWY_SYS_NAME),1)],10,M)]),E("div",K,[E("p",null,h(A(_a).SNOWY_SYS_DEFAULT_DESCRRIPTION),1),E("p",null,h(A(_a).SNOWY_SYS_COPYRIGHT)+" "+h(A(_a).SNOWY_SYS_VERSION),1)]),e[5]||(e[5]=E("div",{class:"welcome-message"},[E("h2",null,"欢迎回来"),E("p",null,"请登录您的账户")],-1))]),E("div",V,[E("div",z,[L(m,{class:"login-card"},{default:Y(()=>[E("div",q,[E("h2",null,h(a.$t("login.signInTitle")),1),e[6]||(e[6]=E("p",{class:"subtitle"},"请输入您的账户信息",-1))]),L(f,{activeKey:A(s),"onUpdate:activeKey":e[3]||(e[3]=a=>P(s)?s.value=a:null),class:"login-tabs"},{default:Y(()=>[L(p,{key:"userAccount",tab:a.$t("login.accountPassword")},{default:Y(()=>[L(S,{ref_key:"loginForm",ref:Sa,model:A(ea),rules:A(la)},{default:Y(()=>[L(i,{name:"account"},{default:Y(()=>[L(r,{value:A(ea).account,"onUpdate:value":e[0]||(e[0]=a=>A(ea).account=a),placeholder:a.$t("login.accountPlaceholder"),size:"large",onKeyup:b(pa,["enter"])},{prefix:Y(()=>[L(o,{class:"login-icon-gray"})]),_:1},8,["value","placeholder"])]),_:1}),L(i,{name:"password"},{default:Y(()=>[L(u,{value:A(ea).password,"onUpdate:value":e[1]||(e[1]=a=>A(ea).password=a),placeholder:a.$t("login.PWPlaceholder"),size:"large",autocomplete:"off",onKeyup:b(pa,["enter"])},{prefix:Y(()=>[L(d,{class:"login-icon-gray"})]),_:1},8,["value","placeholder"])]),_:1}),"true"===A(n)?(y(),T(i,{key:0,name:"validCode"},{default:Y(()=>[L(g,{gutter:8},{default:Y(()=>[L(_,{span:17},{default:Y(()=>[L(r,{value:A(ea).validCode,"onUpdate:value":e[2]||(e[2]=a=>A(ea).validCode=a),placeholder:a.$t("login.validLaceholder"),size:"large",onKeyup:b(pa,["enter"])},{prefix:Y(()=>[L(c,{class:"login-icon-gray"})]),_:1},8,["value","placeholder"])]),_:1}),L(_,{span:7},{default:Y(()=>[E("img",{src:A(X),class:"login-validCode-img",onClick:va},null,8,J)]),_:1})]),_:1})]),_:1})):I("",!0),L(i,null,{default:Y(()=>[L(v,{type:"primary",class:"w-full login-button",loading:A(aa),size:"large",onClick:pa},{default:Y(()=>[R(h(a.$t("login.signIn")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["tab"]),"true"===A(Z)?(y(),T(p,{key:"userSms",tab:a.$t("login.phoneSms"),"force-render":""},{default:Y(()=>[L(A(l))]),_:1},8,["tab"])):I("",!0),"true"===A(Q)?(y(),T(p,{key:"userEmail",tab:a.$t("login.emailLogin"),"force-render":""},{default:Y(()=>[L(A(t))]),_:1},8,["tab"])):I("",!0)]),_:1},8,["activeKey"])]),_:1})])])])}}},Q=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{$ as a,Q as l};
