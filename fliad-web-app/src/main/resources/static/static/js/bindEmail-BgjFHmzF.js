import{_ as e,c as a}from"./index-DcffTgQN.js";import{r as l,a as d}from"./formRules-B2bzcXv4.js";import{F as i,I as t,B as o,k as s}from"./ant-design-vendor-CRFwT3Wn.js";import{d as u,f as n,r as v,a1 as r,a6 as m,V as c,a2 as f,k as C,u as p,U as _,Z as h,G as y,a3 as g}from"./vue-vendor-BzDj5Url.js";const B=["src"],V=u({name:"bindEmail"}),w=e(Object.assign(V,{setup(e,{expose:u}){const V=n(!1),w=n(!1),k=n(!1),I=n(""),R=n(""),q=n(""),b=n("");let j=n({time:60,sendBtn:!1});const N=n(),U=v({email:"",validCode:"",emailValidCode:"",validCodeReqNo:""}),E=()=>{k.value=!0;try{a.userGetPicCaptcha().then(e=>{I.value=e.validCodeBase64,R.value=e.validCodeReqNo})}finally{k.value=!1}},x=async()=>{try{if(!U.email)return void s.error("请输入邮箱号");if(!U.validCode)return void s.error("请输入图片验证码");const e=s.loading("验证码发送中..",0);a.userBindEmailGetEmailValidCode({email:U.email,validCode:U.validCode,validCodeReqNo:R.value},b.value).then(e=>{j.value.sendBtn=!0;const a=window.setInterval(()=>{j.value.time--<=0&&(j.value.time=60,j.value.sendBtn=!1,window.clearInterval(a))},1e3);q.value=e,s.success("验证码已发送到邮箱")}).catch(()=>{U.validCode="",U.validCodeReqNo="",q.value="",E()}).finally(()=>{setTimeout(e,100)})}catch(e){E()}},G=async()=>{try{await N.value.validate(),w.value=!0,a.userBindEmail({email:U.email,validCode:U.emailValidCode,validCodeReqNo:q.value}).then(()=>{s.success("绑定成功"),V.value=!1}).catch(()=>{U.emailValidCode="",q.value=""})}catch(e){}finally{w.value=!1}},F={email:[l("请输入邮箱号"),d.email],validCode:l("请输入图片验证码"),emailValidCode:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"}]},O=()=>{b.value="",V.value=!1,N.value.resetFields()};return u({open:e=>{e&&(U.email=e,b.value=e),V.value=!0,E()}}),(e,a)=>{const l=r("a-col"),d=r("a-row"),s=r("a-modal");return c(),m(s,{open:V.value,"onUpdate:open":a[3]||(a[3]=e=>V.value=e),title:b.value?"修改邮箱":"绑定邮箱",width:400,onOk:G,"destroy-on-close":!0,onCancel:O},{default:f(()=>[C(p(i),{ref_key:"formRef",ref:N,model:U,rules:F,layout:"vertical"},{default:f(()=>[C(p(i).Item,{name:"email"},{default:f(()=>[C(p(t),{value:U.email,"onUpdate:value":a[0]||(a[0]=e=>U.email=e),placeholder:"请输入邮箱号"},null,8,["value"])]),_:1}),C(p(i).Item,{name:"validCode"},{default:f(()=>[C(d,{gutter:8},{default:f(()=>[C(l,{span:16},{default:f(()=>[C(p(t),{value:U.validCode,"onUpdate:value":a[1]||(a[1]=e=>U.validCode=e),placeholder:"请输入图片验证码"},null,8,["value"])]),_:1}),C(l,{span:8},{default:f(()=>[I.value?(c(),_("img",{key:0,src:I.value,class:"captcha-image",onClick:E},null,8,B)):h("",!0)]),_:1})]),_:1})]),_:1}),C(p(i).Item,{name:"emailValidCode"},{default:f(()=>[C(d,{gutter:8},{default:f(()=>[C(l,{span:16},{default:f(()=>[C(p(t),{value:U.emailValidCode,"onUpdate:value":a[2]||(a[2]=e=>U.emailValidCode=e),placeholder:"请输入邮箱验证码"},null,8,["value"])]),_:1}),C(l,{span:8},{default:f(()=>[C(p(o),{loading:k.value,onClick:x,style:{width:"100%"},disabled:p(j).sendBtn},{default:f(()=>[y(g(p(j).sendBtn?p(j).time+" s":"获取验证码"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),[["__scopeId","data-v-a4ad1c02"]]);export{w as default};
