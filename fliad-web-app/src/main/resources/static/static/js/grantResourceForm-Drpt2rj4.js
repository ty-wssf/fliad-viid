import{_ as e}from"./index-yhO5Pkur.js";import{u as a}from"./userApi-BNWGxnHS.js";import{r as t}from"./roleApi-AgyZA8--.js";import{_ as n,u as o,d as u}from"./index-DcffTgQN.js";import{d as l,f as r,a1 as c,a6 as s,V as d,a2 as i,k as h,u as m,H as p,U as f,F as v,W as k,G as b,a7 as g,a3 as I,Z as y}from"./vue-vendor-BzDj5Url.js";import"./ant-design-vendor-CRFwT3Wn.js";const C={key:0},_=l({name:"grantResourceForm"}),x=n(Object.assign(_,{emits:{successful:null},setup(n,{expose:l,emit:_}){const x=r(!1),N=r({}),E=_,U=r(!1),w=[{key:"parentName",title:"一级目录",dataIndex:"parentName",customCell:(e,a)=>{const t=e.parentName,n=N.value[t];return a===n[0]?{rowSpan:n.length}:{rowSpan:0}},width:150},{key:"title",title:"菜单",dataIndex:"title",width:200},{key:"button",title:"按钮授权",dataIndex:"button"}],j=r([]),L=r(""),R=r([]),G=async()=>{if(j.value.length>0)R.value=j.value.find(e=>e.id===L.value).menu;else{x.value=!0;const e=await t.roleResourceTreeSelector(),n={id:A.id},o=await a.userOwnResource(n);x.value=!1,j.value=F(e,o),L.value=e[0].id,R.value=j.value[0].menu}},O=["button"],S=r(!1);let A={id:"",grantInfoList:[]};const F=(e,a)=>(e.forEach(e=>{e.menu&&(e.menu.forEach(e=>{const t=r(0);a.grantInfoList.length>0&&a.grantInfoList.forEach(a=>{e.id===a.menuId&&(t.value++,a.buttonInfo.length>0&&a.buttonInfo.forEach(a=>{e.button.forEach(e=>{a===e.id&&(e.check=!0)})}))}),t.value>0&&(e.parentCheck=!0,e.nameCheck=!0)}),e.menu.sort((e,a)=>{let t=a.parentName.localeCompare(e.parentName);return 0!==t?t:Number(e.parentId)-Number(a.parentId)}),e.menu.forEach((e,a)=>{N.value[e.parentName]?N.value[e.parentName].push(a):N.value[e.parentName]=[a]}))}),e),z=(e,a)=>{let t=a.target.checked;!t&&(e=>O.every(a=>e[a].every(e=>!e.check)))(e)||t&&(e.nameCheck=t,e.parentCheck=t)},H=(e,a)=>{e.nameCheck=a,O.forEach(t=>{((e,a,t)=>{e[a].forEach(e=>{e.check=t})})(e,t,a)})},M=()=>{j.value=[],L.value="",R.value=[],N.value={},S.value=!1},T=()=>{const e=(A.grantInfoList=[],j.value.forEach(e=>{e.menu&&e.menu.forEach(e=>{const a={menuId:"",buttonInfo:[]};e.nameCheck&&(a.menuId=e.id,e.button.forEach(e=>{e.check&&a.buttonInfo.push(e.id)}),A.grantInfoList.push(a))})}),A);U.value=!0,a.userGrantResource(e).then(()=>{M(),E("successful"),V()}).finally(()=>{U.value=!1})},V=()=>{o().fetchMenu(),u().refreshUserLoginUserInfo()};return l({onOpen:e=>{A.id=e.id,S.value=!0,N.value={},G()}}),(a,t)=>{const n=c("a-alert"),o=c("a-radio-button"),u=c("a-radio-group"),l=c("a-checkbox"),r=c("a-table"),_=c("a-spin"),E=c("a-button"),O=e;return d(),s(O,{title:"授权资源",width:1e3,visible:m(S),"destroy-on-close":!0,"show-pagination":!1,onClose:M},{footer:i(()=>[h(E,{class:"xn-mr8",onClick:M},{default:i(()=>t[1]||(t[1]=[b("关闭")])),_:1}),h(E,{type:"primary",loading:m(U),onClick:T},{default:i(()=>t[2]||(t[2]=[b("保存")])),_:1},8,["loading"])]),default:i(()=>[h(n,{message:"非超管角色用户不可被授权系统模块菜单资源",banner:"",class:"mb-2"}),h(_,{spinning:m(x)},{default:i(()=>[h(u,{value:m(L),"onUpdate:value":t[0]||(t[0]=e=>p(L)?L.value=e:null),"button-style":"solid",class:"xn-pb10"},{default:i(()=>[(d(!0),f(v,null,k(m(j),e=>(d(),s(o,{key:e.id,value:e.id,onClick:a=>{return t=e.id,L.value=t,void G();var t}},{default:i(()=>[(d(),s(g(e.icon))),b(" "+I(e.title),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"]),h(r,{size:"middle",columns:w,"data-source":m(R),pagination:!1,bordered:""},{bodyCell:i(({column:e,record:a})=>["parentName"===e.dataIndex?(d(),s(l,{key:0,checked:a.parentCheck,"onUpdate:checked":e=>((e,a)=>{e.parentCheck=a;const t=j.value.find(a=>e.module===a.id),n=e.parentName;N.value[n].forEach(e=>{const n=t.menu[e];H(n,a)})})(a,e)},{default:i(()=>[b(I(a.parentName),1)]),_:2},1032,["checked","onUpdate:checked"])):y("",!0),"title"===e.dataIndex?(d(),s(l,{key:1,checked:a.nameCheck,"onUpdate:checked":e=>H(a,e)},{default:i(()=>[b(I(a.title),1)]),_:2},1032,["checked","onUpdate:checked"])):y("",!0),"button"===e.dataIndex?(d(),f(v,{key:2},[a.button.length>0?(d(!0),f(v,{key:0},k(a.button,(e,t)=>(d(),f(v,{key:e.id},[h(l,{checked:e.check,"onUpdate:checked":a=>e.check=a,onChange:e=>z(a,e)},{default:i(()=>[b(I(e.title),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]),(t+1)%5==0?(d(),f("br",C)):y("",!0)],64))),128)):y("",!0)],64)):y("",!0)]),_:1},8,["data-source"])]),_:1},8,["spinning"])]),_:1},8,["visible"])}}}),[["__scopeId","data-v-c30315bc"]]);export{x as default};
