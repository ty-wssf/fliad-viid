import{_ as e}from"./index-yhO5Pkur.js";import{r as a}from"./roleApi-AgyZA8--.js";import{_ as t,u as n,d as o}from"./index-DcffTgQN.js";import{d as l,f as u,a1 as c,a6 as r,V as d,a2 as s,k as i,u as h,H as m,U as p,F as f,W as v,G as k,a7 as b,a3 as g,Z as I}from"./vue-vendor-BzDj5Url.js";import"./ant-design-vendor-CRFwT3Wn.js";const y={key:0},C=l({name:"grantResourceForm"}),_=t(Object.assign(C,{emits:{successful:null},setup(t,{expose:l,emit:C}){const _=u(!1),x=u({}),N=C,E=u(!1),U=[{key:"parentName",title:"一级目录",dataIndex:"parentName",customCell:(e,a)=>{const t=e.parentName,n=x.value[t];return a===n[0]?{rowSpan:n.length}:{rowSpan:0}},width:150},{key:"title",title:"菜单",dataIndex:"title",width:240},{key:"button",title:"按钮授权",dataIndex:"button"}],w=u([]),j=u(""),L=u([]),R=async()=>{if(w.value.length>0)L.value=w.value.find(e=>e.id===j.value).menu;else{_.value=!0;const e=await a.roleResourceTreeSelector(),t={id:S.id},n=await a.roleOwnResource(t);_.value=!1,w.value=F(e,n),j.value=e[0].id,L.value=w.value[0].menu}},G=["button"],O=u(!1);let S={id:"",grantInfoList:[]};const F=(e,a)=>(e.forEach(e=>{e.menu&&(e.menu.forEach(e=>{const t=u(0);a.grantInfoList.length>0&&a.grantInfoList.forEach(a=>{e.id===a.menuId&&(t.value++,a.buttonInfo.length>0&&a.buttonInfo.forEach(a=>{e.button.forEach(e=>{a===e.id&&(e.check=!0)})}))}),t.value>0&&(e.parentCheck=!0,e.nameCheck=!0)}),e.menu.sort((e,a)=>{let t=a.parentName.localeCompare(e.parentName);return 0!==t?t:Number(e.parentId)-Number(a.parentId)}),e.menu.forEach((e,a)=>{x.value[e.parentName]?x.value[e.parentName].push(a):x.value[e.parentName]=[a]}))}),e),z=(e,a)=>{let t=a.target.checked;!t&&(e=>G.every(a=>e[a].every(e=>!e.check)))(e)||t&&(e.nameCheck=t,e.parentCheck=t)},A=(e,a)=>{e.nameCheck=a,G.forEach(t=>{((e,a,t)=>{e[a].forEach(e=>{e.check=t})})(e,t,a)})},H=()=>{w.value=[],j.value="",L.value=[],x.value={},O.value=!1},M=()=>{const e=(S.grantInfoList=[],w.value.forEach(e=>{e.menu&&e.menu.forEach(e=>{const a={menuId:"",buttonInfo:[]};e.nameCheck&&(a.menuId=e.id,e.button.forEach(e=>{e.check&&a.buttonInfo.push(e.id)}),S.grantInfoList.push(a))})}),S);E.value=!0,a.roleGrantResource(e).then(()=>{H(),N("successful"),T()}).finally(()=>{E.value=!1})},T=()=>{n().fetchMenu(),o().refreshUserLoginUserInfo()};return l({onOpen:e=>{S.id=e.id,O.value=!0,x.value={},R()}}),(a,t)=>{const n=c("a-alert"),o=c("a-radio-button"),l=c("a-radio-group"),u=c("a-checkbox"),C=c("a-table"),N=c("a-spin"),G=c("a-button"),S=e;return d(),r(S,{title:"授权资源",width:1e3,visible:h(O),"destroy-on-close":!0,"show-pagination":!1,onClose:H},{footer:s(()=>[i(G,{class:"xn-mr8",onClick:H},{default:s(()=>t[1]||(t[1]=[k("关闭")])),_:1}),i(G,{type:"primary",loading:h(E),onClick:M},{default:s(()=>t[2]||(t[2]=[k("保存")])),_:1},8,["loading"])]),default:s(()=>[i(n,{message:"非超管角色不可被授权系统模块菜单资源",banner:"",class:"mb-2"}),i(N,{spinning:h(_)},{default:s(()=>[i(l,{value:h(j),"onUpdate:value":t[0]||(t[0]=e=>m(j)?j.value=e:null),"button-style":"solid",class:"xn-pb10"},{default:s(()=>[(d(!0),p(f,null,v(h(w),e=>(d(),r(o,{key:e.id,value:e.id,onClick:a=>{return t=e.id,j.value=t,void R();var t}},{default:s(()=>[(d(),r(b(e.icon))),k(" "+g(e.title),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"]),i(C,{size:"middle",columns:U,"data-source":h(L),pagination:!1,bordered:""},{bodyCell:s(({column:e,record:a})=>["parentName"===e.dataIndex?(d(),r(u,{key:0,checked:a.parentCheck,"onUpdate:checked":e=>((e,a)=>{e.parentCheck=a;const t=w.value.find(a=>e.module===a.id),n=e.parentName;x.value[n].forEach(e=>{const n=t.menu[e];A(n,a)})})(a,e)},{default:s(()=>[k(g(a.parentName),1)]),_:2},1032,["checked","onUpdate:checked"])):I("",!0),"title"===e.dataIndex?(d(),r(u,{key:1,checked:a.nameCheck,"onUpdate:checked":e=>A(a,e)},{default:s(()=>[k(g(a.title),1)]),_:2},1032,["checked","onUpdate:checked"])):I("",!0),"button"===e.dataIndex?(d(),p(f,{key:2},[a.button.length>0?(d(!0),p(f,{key:0},v(a.button,(e,t)=>(d(),p(f,{key:e.id},[i(u,{checked:e.check,"onUpdate:checked":a=>e.check=a,onChange:e=>z(a,e)},{default:s(()=>[k(g(e.title),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]),(t+1)%5==0?(d(),p("br",y)):I("",!0)],64))),128)):I("",!0)],64)):I("",!0)]),_:1},8,["data-source"])]),_:1},8,["spinning"])]),_:1},8,["visible"])}}}),[["__scopeId","data-v-e8e3e9fb"]]);export{_ as default};
