import{a5 as e,ac as a,f as l,c as s,o,a1 as r,U as u,V as t,Y as d,k as i,a2 as n,a6 as v,Z as c,ah as _,G as p}from"./vue-vendor-BzDj5Url.js";import{r as f,a as g}from"./formRules-B2bzcXv4.js";import{_ as m,g as C,D as w,t as S}from"./index-DcffTgQN.js";import{s as y}from"./smCrypto-fJLAcgxS.js";import{c as h}from"./clientLoginApi-CbOluBR5.js";import{c as N}from"./configApi-BMiyCPj3.js";import{w as A,b as P,k as O}from"./ant-design-vendor-CRFwT3Wn.js";const E={class:"login-wrapper"},F={class:"login_main"},R={class:"login-form"},Y=["src"],x=m({__name:"index",setup(m){const x=e(),j=a(),L=l(!1),b=l(),G=l(!1),U=C(),k=U.setSysBaseConfig;s(()=>U.sysBaseConfig);const q=l({account:"",password:"",newPassword:"",validCode:"",validCodeReqNo:""}),B=l({account:[f("请输入账号")],password:[f("请输入密码"),{validator:(e,a)=>a&&q.value.newPassword&&a!==q.value.newPassword?Promise.reject("两次输入的密码不一致"):Promise.resolve(),trigger:["change","blur"]}],newPassword:[f("请再次输入密码"),{validator:(e,a)=>a&&q.value.password&&a!==q.value.password?Promise.reject("两次输入的密码不一致"):Promise.resolve(),trigger:["change","blur"]}]}),T=l(w.SYS_BASE_CONFIG.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN_FLAG_FOR_C),W=l("false"),z=l("");o(()=>{A(x.query.tenCode)||(q.value.tenCode=x.query.tenCode),G.value=!0,S.data.set("SNOWY_TEN_CODE",""),D()});const D=()=>{let e=l(w.SYS_BASE_CONFIG);N.configSysBaseList().then(a=>{G.value=!1,a&&(a.forEach(a=>{e.value[a.configKey]=a.configValue}),T.value=e.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN_FLAG_FOR_C,W.value=e.value.SNOWY_SYS_DEFAULT_ALLOW_REGISTER_FLAG_FOR_C,S.data.set("SNOWY_SYS_BASE_CONFIG",e.value),k(e.value),I())}).catch(()=>{})},I=()=>{"true"===T.value&&(K(),B.value.validCode=[f("请输入验证码","blur"),g.lettersNum])},H=()=>{B.value.validCode=[f("请输入验证码"),g.lettersNum],b.value.validate().then(()=>{G.value=!1,L.value=!0;const e={account:q.value.account,password:y.doSm2Encrypt(P(q.value.password)),validCode:q.value.validCode,validCodeReqNo:q.value.validCodeReqNo};h.clientRegister(e).then(()=>{j.replace({path:"/front/client/login"}),O.success("注册成功")}).catch(()=>{"true"===T.value&&K()}).finally(()=>{L.value=!1})}).catch(()=>{})},K=()=>{h.clientGetPicCaptcha().then(e=>{z.value=e.validCodeBase64,q.value.validCodeReqNo=e.validCodeReqNo,q.value.validCode=void 0})};return(e,a)=>{const l=r("user-outlined"),s=r("a-input"),o=r("a-form-item"),f=r("lock-outlined"),g=r("a-input-password"),m=r("verified-outlined"),C=r("a-col"),w=r("a-row"),S=r("a-button"),y=r("a-form"),h=r("a-card");return t(),u("div",E,[d("div",F,[d("div",R,[i(h,null,{default:n(()=>[a[6]||(a[6]=d("div",{class:"login-header",style:{"margin-bottom":"20px"}},[d("h2",null,"用户注册")],-1)),i(y,{ref_key:"registerFormRef",ref:b,model:q.value,rules:B.value,class:"user-box",autocomplete:"off"},{default:n(()=>[i(o,{name:"account"},{default:n(()=>[i(s,{value:q.value.account,"onUpdate:value":a[0]||(a[0]=e=>q.value.account=e),placeholder:"请输入账号",size:"large"},{prefix:n(()=>[i(l,{class:"login-icon-gray"})]),_:1},8,["value"])]),_:1}),i(o,{name:"password"},{default:n(()=>[i(g,{value:q.value.password,"onUpdate:value":a[1]||(a[1]=e=>q.value.password=e),placeholder:"请输入密码",size:"large"},{prefix:n(()=>[i(f,{class:"login-icon-gray"})]),_:1},8,["value"])]),_:1}),i(o,{name:"newPassword"},{default:n(()=>[i(g,{value:q.value.newPassword,"onUpdate:value":a[2]||(a[2]=e=>q.value.newPassword=e),placeholder:"请再次输入密码",size:"large"},{prefix:n(()=>[i(f,{class:"login-icon-gray"})]),_:1},8,["value"])]),_:1}),"true"===T.value?(t(),v(o,{key:0,name:"validCode"},{default:n(()=>[i(w,{gutter:8},{default:n(()=>[i(C,{span:17},{default:n(()=>[i(s,{value:q.value.validCode,"onUpdate:value":a[3]||(a[3]=e=>q.value.validCode=e),placeholder:"请输入验证码",size:"large",onKeyup:_(H,["enter"])},{prefix:n(()=>[i(m,{class:"login-icon-gray"})]),_:1},8,["value"])]),_:1}),i(C,{span:7},{default:n(()=>[d("img",{src:z.value,class:"login-validCode-img",onClick:K},null,8,Y)]),_:1})]),_:1})]),_:1})):c("",!0),i(o,null,{default:n(()=>[i(S,{type:"primary",class:"w-full",loading:L.value,round:"",size:"large",onClick:H,disabled:G.value},{default:n(()=>a[4]||(a[4]=[p(" 注册 ")])),_:1},8,["loading","disabled"])]),_:1}),a[5]||(a[5]=d("div",{style:{display:"flex","justify-content":"flex-end"}},[d("a",{href:"/front/client/login"},"已有账号？前往登录")],-1))]),_:1},8,["model","rules"])]),_:1})])])])}}},[["__scopeId","data-v-132e1078"]]);export{x as default};
