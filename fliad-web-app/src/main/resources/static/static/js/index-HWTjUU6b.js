import{_ as e}from"./index-r8v7tfQO.js";import{t as a}from"./index-DcffTgQN.js";import{_ as t,j as o}from"./form-Rb4z0rbg.js";import{d as l,f as n,a1 as s,U as r,V as d,k as i,a2 as u,u as c,G as p,Z as f,a6 as m,F as b,a3 as h,Y as y}from"./vue-vendor-BzDj5Url.js";import"./ant-design-vendor-CRFwT3Wn.js";import"./index-yhO5Pkur.js";import"./formRules-B2bzcXv4.js";import"./data-BOS9iFY_.js";const v=["onClick"],g=["onClick"],_=l({name:"devJob"}),j=Object.assign(_,{setup(l){const _=n({}),j=n(),k=n(),x=n(),C=n(!1),S={refresh:!0,height:!0,columnSetting:!1,striped:!1},w=[{title:"名称",dataIndex:"name"},{title:"任务类名",dataIndex:"actionClass",ellipsis:!0},{title:"表达式",dataIndex:"cronExpression",ellipsis:!0},{title:"状态",dataIndex:"jobStatus",width:"100px"},{title:"启停",dataIndex:"jobStatusUpdate",width:"120px"},{title:"排序",dataIndex:"sortCode",sorter:!0,width:"80px"},{title:"操作",dataIndex:"action",align:"center",width:"220px"}];let O=n([]);const I={alert:{show:!1,clear:()=>{O=n([])}},rowSelection:{onChange:(e,a)=>{O.value=e}}},R=e=>o.jobPage(Object.assign(e,_.value)).then(e=>e),N=()=>{j.value.resetFields(),k.value.refresh(!0)},U=e=>{o.jobDelete(e).then(()=>{k.value.clearRefreshSelected()})},T=a.dictList("JOB_CATEGORY"),J=a.dictList("JOB_STATUS");return(a,l)=>{const n=s("a-input"),B=s("a-form-item"),D=s("a-col"),G=s("a-select"),K=s("a-button"),P=s("a-row"),A=s("a-form"),L=s("a-card"),E=s("plus-outlined"),F=e,Y=s("a-space"),$=s("a-badge"),z=s("a-switch"),V=s("a-divider"),W=s("a-popconfirm"),Z=s("s-table");return d(),r(b,null,[i(L,{bordered:!1,"body-style":{"padding-bottom":"0px"},class:"mb-2"},{default:u(()=>[i(A,{ref_key:"searchFormRef",ref:j,name:"advanced_search",model:c(_),class:"ant-advanced-search-form"},{default:u(()=>[i(P,{gutter:24},{default:u(()=>[i(D,{span:6},{default:u(()=>[i(B,{label:"关键词",name:"searchKey"},{default:u(()=>[i(n,{value:c(_).searchKey,"onUpdate:value":l[0]||(l[0]=e=>c(_).searchKey=e),placeholder:"请输入关键词"},null,8,["value"])]),_:1})]),_:1}),i(D,{span:6},{default:u(()=>[i(B,{label:"分类",name:"category"},{default:u(()=>[i(G,{value:c(_).category,"onUpdate:value":l[1]||(l[1]=e=>c(_).category=e),placeholder:"请选择分类",options:c(T),getPopupContainer:e=>e.parentNode},null,8,["value","options","getPopupContainer"])]),_:1})]),_:1}),i(D,{span:6},{default:u(()=>[i(B,{label:"状态",name:"jobStatus"},{default:u(()=>[i(G,{value:c(_).jobStatus,"onUpdate:value":l[2]||(l[2]=e=>c(_).jobStatus=e),placeholder:"请选择状态",options:c(J),getPopupContainer:e=>e.parentNode},null,8,["value","options","getPopupContainer"])]),_:1})]),_:1}),i(D,{span:6},{default:u(()=>[i(K,{type:"primary",onClick:l[3]||(l[3]=e=>c(k).refresh(!0))},{default:u(()=>l[6]||(l[6]=[p("查询")])),_:1}),i(K,{class:"xn-mg08",onClick:N},{default:u(()=>l[7]||(l[7]=[p("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),i(L,{bordered:!1},{default:u(()=>[i(Z,{ref_key:"tableRef",ref:k,columns:w,data:R,alert:I.alert.show,bordered:"","row-key":e=>e.id,"tool-config":S,"row-selection":I.rowSelection},{operator:u(()=>[i(Y,null,{default:u(()=>[i(K,{type:"primary",onClick:l[4]||(l[4]=e=>c(x).onOpen())},{icon:u(()=>[i(E)]),default:u(()=>[l[8]||(l[8]=p(" 新增 "))]),_:1}),i(F,{buttonName:"批量删除",icon:"DeleteOutlined",buttonDanger:"",selectedRowKeys:c(O),onBatchCallBack:U},null,8,["selectedRowKeys"])]),_:1})]),bodyCell:u(({column:e,record:t})=>["category"===e.dataIndex?(d(),r(b,{key:0},[p(h(a.$TOOL.dictTypeData("JOB_CATEGORY",t.category)),1)],64)):f("",!0),"jobStatus"===e.dataIndex?(d(),r(b,{key:1},["RUNNING"===t.jobStatus?(d(),m($,{key:0,status:"processing"})):(d(),m($,{key:1,status:"default"})),p(" "+h(a.$TOOL.dictTypeData("JOB_STATUS",t.jobStatus)),1)],64)):f("",!0),"jobStatusUpdate"===e.dataIndex?(d(),m(z,{key:2,loading:c(C),checked:"RUNNING"===t.jobStatus,onChange:e=>(e=>{C.value=!0,"RUNNING"===e.jobStatus?o.jobStopJob(e).then(()=>{k.value.refresh()}).finally(()=>{C.value=!1}):o.jobRunJob(e).then(()=>{k.value.refresh()}).finally(()=>{C.value=!1})})(t)},null,8,["loading","checked","onChange"])):f("",!0),"action"===e.dataIndex?(d(),m(Y,{key:3},{default:u(()=>[y("a",{onClick:e=>(e=>{const a={id:e.id};o.jobRunJobNow(a).then(()=>{k.value.refresh(!0)})})(t)},"立即运行",8,v),i(V,{type:"vertical"}),y("a",{onClick:e=>c(x).onOpen(t)},"编辑",8,g),i(V,{type:"vertical"}),i(W,{title:"确定要删除此定时任务吗？",onConfirm:e=>(e=>{let a=[{id:e.id}];o.jobDelete(a).then(()=>{k.value.refresh(!0)})})(t)},{default:u(()=>[i(K,{type:"link",danger:"",size:"small"},{default:u(()=>l[9]||(l[9]=[p("删除")])),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):f("",!0)]),_:1},8,["alert","row-key","row-selection"])]),_:1}),i(t,{ref_key:"formRef",ref:x,onSuccessful:l[5]||(l[5]=e=>c(k).refresh(!0))},null,512)],64)}}});export{j as default};
