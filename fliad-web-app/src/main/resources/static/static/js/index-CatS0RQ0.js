import{_ as e}from"./index-r8v7tfQO.js";import{_ as a,v as t}from"./form-ClYdT71i.js";import{i as l}from"./index-DcffTgQN.js";import{k as r}from"./ant-design-vendor-CRFwT3Wn.js";import{d as s,r as i,f as n,o,a1 as d,U as u,V as c,k as f,a2 as p,u as v,F as m,W as h,a6 as y,G as k,a3 as D,Z as b}from"./vue-vendor-BzDj5Url.js";import"./formRules-B2bzcXv4.js";const _=["onClick"],g=["onClick"],x=s({name:"datasource"}),w=Object.assign(x,{setup(s){let x=i({});const w=n(),C=n(),I=n();n();const O={refresh:!0,height:!0,columnSetting:!0,striped:!1},j=n(!1),E=n([{label:"RabbitMQ",value:"rabbitmq"}]),P=e=>{const a=E.value.find(a=>a.value===e);return a?a.label:e};o(()=>{});const S=[{title:"ID",dataIndex:"id"},{title:"标题",dataIndex:"title"},{title:"订阅类别",dataIndex:"subscribeDetail"},{title:"类型",dataIndex:"type"},{title:"状态",dataIndex:"status"},{title:"备注",dataIndex:"remark",ellipsis:!0}];l(["viidDatasourceEdit","viidDatasourceDelete"])&&S.push({title:"操作",dataIndex:"action",align:"center",width:"240px"});let R=n([]);const A={alert:{show:!1,clear:()=>{R=n([])}},rowSelection:{onChange:(e,a)=>{R.value=e}}},B=e=>{const a=JSON.parse(JSON.stringify(x));return t.viidDatasourcePage(Object.assign(e,a)).then(e=>e)},N=()=>{if(R.value.length<1)return r.warning("请选择一条或多条数据"),!1;const e=R.value.map(e=>({id:e}));t.viidDatasourceDelete(e).then(()=>{C.value.clearRefreshSelected()})};return(l,r)=>{const s=d("a-input"),i=d("a-form-item"),n=d("a-col"),o=d("a-select-option"),L=d("a-select"),F=d("a-button"),T=d("a-row"),U=d("a-form"),J=d("plus-outlined"),K=e,V=d("a-space"),q=d("a-tag"),z=d("a-switch"),G=d("a-divider"),M=d("a-popconfirm"),Q=d("s-table"),W=d("a-card");return c(),u(m,null,[f(W,{bordered:!1},{default:p(()=>[f(U,{ref_key:"searchFormRef",ref:w,name:"advanced_search",model:v(x),class:"ant-advanced-search-form mb-4"},{default:p(()=>[f(T,{gutter:24},{default:p(()=>[f(n,{span:6},{default:p(()=>[f(i,{label:"标题",name:"title"},{default:p(()=>[f(s,{value:v(x).title,"onUpdate:value":r[0]||(r[0]=e=>v(x).title=e),placeholder:"请输入标题"},null,8,["value"])]),_:1})]),_:1}),f(n,{span:6},{default:p(()=>[f(i,{label:"类型",name:"type"},{default:p(()=>[f(L,{value:v(x).type,"onUpdate:value":r[1]||(r[1]=e=>v(x).type=e),placeholder:"请选择类型","allow-clear":""},{default:p(()=>[(c(!0),u(m,null,h(v(E),e=>(c(),y(o,{key:e.value,value:e.value},{default:p(()=>[k(D(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),f(n,{span:6},{default:p(()=>[f(F,{type:"primary",onClick:r[2]||(r[2]=e=>v(C).refresh(!0))},{default:p(()=>r[6]||(r[6]=[k("查询")])),_:1}),f(F,{style:{margin:"0 8px"},onClick:r[3]||(r[3]=()=>v(w).resetFields())},{default:p(()=>r[7]||(r[7]=[k("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),f(Q,{ref_key:"table",ref:C,columns:S,data:B,alert:A.alert.show,bordered:"","row-key":e=>e.id,"tool-config":O,"row-selection":A.rowSelection},{operator:p(()=>[f(V,null,{default:p(()=>[l.hasPerm("viidDatasourceAdd")?(c(),y(F,{key:0,type:"primary",onClick:r[4]||(r[4]=e=>v(I).onOpen())},{icon:p(()=>[f(J)]),default:p(()=>[r[8]||(r[8]=k(" 新增 "))]),_:1})):b("",!0),l.hasPerm("viidDatasourceBatchDelete")?(c(),y(K,{key:1,buttonName:"批量删除",icon:"DeleteOutlined",selectedRowKeys:v(R),onBatchCallBack:N},null,8,["selectedRowKeys"])):b("",!0)]),_:1})]),bodyCell:p(({column:e,record:a})=>["subscribeDetail"===e.dataIndex?(c(),y(q,{key:0,color:"processing"},{default:p(()=>[k(D(l.$TOOL.dictTypeData("VIID_Subscribe_Detail_Type",a.subscribeDetail)),1)]),_:2},1024)):b("",!0),"type"===e.dataIndex?(c(),u(m,{key:1},[k(D(P(a.type)),1)],64)):b("",!0),"status"===e.dataIndex?(c(),y(z,{key:2,loading:v(j),checked:"ENABLE"===a.status,onChange:e=>(e=>{j.value=!0,"ENABLE"===e.status?t.disableDatasource(e).then(()=>{C.value.refresh(!0)}).finally(()=>{j.value=!1}):t.enableDatasource(e).then(()=>{C.value.refresh(!0)}).finally(()=>{j.value=!1})})(a)},null,8,["loading","checked","onChange"])):b("",!0),"action"===e.dataIndex?(c(),u(m,{key:3},[l.hasPerm("viidDatasourceAdd")?(c(),u("a",{key:0,onClick:e=>(e=>{t.viidDatasourceCopy({id:e.id}).then(()=>{C.value.refresh(!0)})})(a)},"复制",8,_)):b("",!0),l.hasPerm(["viidDatasourceAdd","viidDatasourceEdit"],"and")?(c(),y(G,{key:1,type:"vertical"})):b("",!0),l.hasPerm("viidDatasourceEdit")?(c(),u("a",{key:2,onClick:e=>v(I).onOpen(a)},"编辑",8,g)):b("",!0),l.hasPerm(["viidDatasourceEdit","viidDatasourceDelete"],"and")?(c(),y(G,{key:3,type:"vertical"})):b("",!0),f(M,{title:"确定要删除吗？",onConfirm:e=>(e=>{let a=[{id:e.id}];t.viidDatasourceDelete(a).then(()=>{C.value.refresh(!0)})})(a)},{default:p(()=>[l.hasPerm("viidDatasourceDelete")?(c(),y(F,{key:0,type:"link",danger:"",size:"small"},{default:p(()=>r[9]||(r[9]=[k("删除")])),_:1})):b("",!0)]),_:2},1032,["onConfirm"])],64)):b("",!0)]),_:1},8,["alert","row-key","row-selection"])]),_:1}),f(a,{ref_key:"formRef",ref:I,onSuccessful:r[5]||(r[5]=e=>v(C).refresh(!0))},null,512)],64)}}});export{w as default};
